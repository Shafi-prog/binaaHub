(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46251:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>f,routeModule:()=>l,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{OPTIONS:()=>p,POST:()=>u});var o=t(96559),n=t(48088),a=t(37719),i=t(32190),c=t(39398);async function u(e){try{let{email:s,password:t}=await e.json(),r="https://lqhopwohuddhapkhhikf.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!r||!o)return i.NextResponse.json({success:!1,error:"Server configuration error"},{status:500});let n=(0,c.createClient)(r,o,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:a,error:u}=await n.auth.signInWithPassword({email:s,password:t});if(u||!a.session)return i.NextResponse.json({success:!1,error:u?.message||"Invalid credentials"},{status:401});let{data:p,error:l}=await n.from("users").select("account_type").eq("email",s).single(),d=p;if(l||!d?.account_type)if(l?.code!=="PGRST116")return i.NextResponse.json({success:!1,error:"Failed to fetch user data"},{status:500});else{let e="BinnaHub-"+Math.random().toString(36).substring(2,10),t={id:a.session.user.id,email:s,account_type:"user",name:a.session.user.email?.split("@")[0]||"User",is_verified:!0,status:"active",invitation_code:e},{error:r}=await n.from("users").insert([t]);if(r)return i.NextResponse.json({success:!1,error:"Failed to create user data"},{status:500});d={account_type:t.account_type}}let h="store"===d.account_type?"/store/dashboard":"user"===d.account_type||"client"===d.account_type?"/user/dashboard":"engineer"===d.account_type||"consultant"===d.account_type?"/dashboard/construction-data":"/",x=i.NextResponse.json({success:!0,redirectTo:h,user:{email:a.session.user.email,account_type:d.account_type},session:{access_token:a.session.access_token,refresh_token:a.session.refresh_token,expires_at:a.session.expires_at}});return x.cookies.set("sb-access-token",a.session.access_token,{path:"/",maxAge:86400,httpOnly:!0,secure:!0,sameSite:"none"}),x.cookies.set("sb-refresh-token",a.session.refresh_token,{path:"/",maxAge:604800,httpOnly:!0,secure:!0,sameSite:"none"}),x.cookies.set("auth_session_active","true",{path:"/",maxAge:86400,httpOnly:!0,secure:!0,sameSite:"none"}),x.headers.set("Access-Control-Allow-Credentials","true"),x.headers.set("Access-Control-Allow-Origin","https://binaa-o7tjghhf8-shafi-projs-projects.vercel.app"),x.headers.set("Access-Control-Allow-Methods","POST, OPTIONS"),x.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),x}catch(s){let e=i.NextResponse.json({success:!1,error:"Internal server error",details:s instanceof Error?s.message:"Unknown error"},{status:500});return e.headers.set("Access-Control-Allow-Credentials","true"),e.headers.set("Access-Control-Allow-Origin","https://binaa-o7tjghhf8-shafi-projs-projects.vercel.app"),e}}async function p(e){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"https://binaa-o7tjghhf8-shafi-projs-projects.vercel.app","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Access-Control-Allow-Credentials":"true"}})}let l=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:d,workUnitAsyncStorage:h,serverHooks:x}=l;function f(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:h})}},47990:()=>{},51906:e=>{function s(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}s.keys=()=>[],s.resolve=s,s.id=51906,e.exports=s},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4243,580,9398],()=>t(46251));module.exports=r})();