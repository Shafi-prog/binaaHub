(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[832],{213:(e,r,t)=>{Promise.resolve().then(t.bind(t,1554))},1554:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var o=t(5155),l=t(2115),s=t(5695),n=t(3579),a=t(6695),i=t(9503),c=t(6733),d=t(640);function u(){let e=(0,s.useParams)(),r=(0,s.useRouter)(),t=e.id,[u,g]=(0,l.useState)(null),[p,m]=(0,l.useState)(!0),[x,h]=(0,l.useState)(!1),[b,j]=(0,l.useState)(null),[y,f]=(0,l.useState)({name:"",description:"",project_type:"",address:"",city:"",region:"",budget:"",end_date:"",priority:"medium",status:"planning",progress_percentage:"",actual_cost:"",location_lat:"",location_lng:""});(0,n.createClientComponentClient)(),(0,l.useEffect)(()=>{(async()=>{try{console.log("\uD83D\uDD0D [Edit Project] Verifying authentication...");let e=await (0,c.s)(3);e?(console.log("✅ [Edit Project] User authenticated:",e.email),g(e.user),j(null),v()):(console.error("❌ [Edit Project] Authentication failed"),j("يرجى تسجيل الدخول للمتابعة"),r.push("/login"))}catch(e){console.error("❌ [Edit Project] Auth error:",e),j("خطأ في المصادقة"),r.push("/login")}finally{m(!1)}})()},[r,t]);let v=async()=>{try{console.log("\uD83D\uDD0D Loading project data for editing:",t);let s=await (0,d.G6)(t);if(s){var e,o,l;f({name:s.name,description:s.description||"",project_type:s.project_type,address:s.address||"",city:s.city||"",region:s.region||"",budget:(null==(e=s.budget)?void 0:e.toString())||"",end_date:s.expected_completion_date||"",priority:s.priority,status:s.status,progress_percentage:(null==(o=s.progress_percentage)?void 0:o.toString())||"",actual_cost:(null==(l=s.actual_cost)?void 0:l.toString())||"",location_lat:s.location?(JSON.parse(s.location).lat||"").toString():"",location_lng:s.location?(JSON.parse(s.location).lng||"").toString():""}),console.log("✅ Project data loaded for editing")}else console.error("❌ Project not found for editing"),alert("المشروع غير موجود"),r.push("/user/projects")}catch(e){console.error("Error loading project data:",e),alert("حدث خطأ في تحميل بيانات المشروع"),r.push("/user/projects")}},_=e=>{let{name:r,value:t}=e.target;f(e=>({...e,[r]:t}))},N=async e=>{if(e.preventDefault(),u){h(!0);try{console.log("Updating project:",y);let e={name:y.name,description:y.description,project_type:y.project_type,address:y.address||void 0,city:y.city||void 0,region:y.region||void 0,budget:y.budget?parseFloat(y.budget):void 0,expected_completion_date:y.end_date||void 0,priority:y.priority,status:y.status,progress_percentage:y.progress_percentage?parseInt(y.progress_percentage):void 0,actual_cost:y.actual_cost?parseFloat(y.actual_cost):void 0,location:y.location_lat&&y.location_lng?JSON.stringify({lat:parseFloat(y.location_lat),lng:parseFloat(y.location_lng)}):void 0},o=await (0,d.vr)(t,e);console.log("✅ Project updated successfully:",o),r.push("/user/projects/".concat(t))}catch(e){console.error("Error updating project:",e),alert("حدث خطأ في تحديث المشروع")}finally{h(!1)}}};return p?(0,o.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,o.jsx)(i.k,{})}):b?(0,o.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,o.jsxs)(a.Z,{className:"p-6 text-center",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"خطأ في المصادقة"}),(0,o.jsx)("p",{className:"text-gray-600",children:b})]})}):(0,o.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,o.jsxs)("div",{className:"container mx-auto px-4 max-w-4xl",children:[(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,o.jsx)("button",{onClick:()=>r.back(),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"تعديل المشروع"})]}),(0,o.jsx)("p",{className:"text-gray-600",children:"تحديث تفاصيل المشروع ومعلوماته"})]}),(0,o.jsx)(a.Z,{className:"p-6",children:(0,o.jsxs)("form",{onSubmit:N,className:"space-y-6",children:[" ",(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"اسم المشروع *"}),(0,o.jsx)("input",{type:"text",id:"name",name:"name",value:y.name,onChange:_,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"وصف المشروع"}),(0,o.jsx)("textarea",{id:"description",name:"description",value:y.description,onChange:_,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})," ",(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"project_type",className:"block text-sm font-medium text-gray-700 mb-2",children:"نوع المشروع *"}),(0,o.jsxs)("select",{id:"project_type",name:"project_type",value:y.project_type,onChange:_,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,o.jsx)("option",{value:"",children:"اختر نوع المشروع"}),(0,o.jsx)("option",{value:"residential",children:"سكني"}),(0,o.jsx)("option",{value:"commercial",children:"تجاري"}),(0,o.jsx)("option",{value:"industrial",children:"صناعي"}),(0,o.jsx)("option",{value:"infrastructure",children:"بنية تحتية"}),(0,o.jsx)("option",{value:"renovation",children:"تجديد"}),(0,o.jsx)("option",{value:"other",children:"أخرى"})]})]})}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-2",children:"العنوان التفصيلي"}),(0,o.jsx)("input",{type:"text",id:"address",name:"address",value:y.address,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل العنوان التفصيلي"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-2",children:"المدينة"}),(0,o.jsx)("input",{type:"text",id:"city",name:"city",value:y.city,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل المدينة"})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"region",className:"block text-sm font-medium text-gray-700 mb-2",children:"المنطقة"}),(0,o.jsx)("input",{type:"text",id:"region",name:"region",value:y.region,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل المنطقة"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"حالة المشروع"}),(0,o.jsxs)("select",{id:"status",name:"status",value:y.status,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,o.jsx)("option",{value:"planning",children:"تخطيط"}),(0,o.jsx)("option",{value:"design",children:"تصميم"}),(0,o.jsx)("option",{value:"permits",children:"تراخيص"}),(0,o.jsx)("option",{value:"construction",children:"بناء"}),(0,o.jsx)("option",{value:"finishing",children:"تشطيب"}),(0,o.jsx)("option",{value:"completed",children:"مكتمل"}),(0,o.jsx)("option",{value:"on_hold",children:"متوقف"})]})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"budget",className:"block text-sm font-medium text-gray-700 mb-2",children:"الميزانية المقدرة (ريال سعودي)"}),(0,o.jsx)("input",{type:"number",id:"budget",name:"budget",value:y.budget,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700 mb-2",children:"تاريخ الإنجاز المتوقع"}),(0,o.jsx)("input",{type:"date",id:"end_date",name:"end_date",value:y.end_date,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-2",children:"الأولوية"}),(0,o.jsxs)("select",{id:"priority",name:"priority",value:y.priority,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,o.jsx)("option",{value:"low",children:"منخفضة"}),(0,o.jsx)("option",{value:"medium",children:"متوسطة"}),(0,o.jsx)("option",{value:"high",children:"عالية"}),(0,o.jsx)("option",{value:"urgent",children:"عاجلة"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"progress_percentage",className:"block text-sm font-medium text-gray-700 mb-2",children:"نسبة الإنجاز (%)"}),(0,o.jsx)("input",{type:"number",id:"progress_percentage",name:"progress_percentage",min:0,max:100,value:y.progress_percentage,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0-100"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"actual_cost",className:"block text-sm font-medium text-gray-700 mb-2",children:"التكلفة الفعلية (ريال سعودي)"}),(0,o.jsx)("input",{type:"number",id:"actual_cost",name:"actual_cost",value:y.actual_cost,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"location_lat",className:"block text-sm font-medium text-gray-700 mb-2",children:"خط العرض (Latitude)"}),(0,o.jsx)("input",{type:"number",id:"location_lat",name:"location_lat",value:y.location_lat,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"مثال: 24.7136",step:"any"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"location_lng",className:"block text-sm font-medium text-gray-700 mb-2",children:"خط الطول (Longitude)"}),(0,o.jsx)("input",{type:"number",id:"location_lng",name:"location_lng",value:y.location_lng,onChange:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"مثال: 46.6753",step:"any"})]})]}),(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[" ",(0,o.jsx)("button",{type:"submit",disabled:x||!y.name.trim()||!y.project_type.trim(),className:"flex-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2",children:x?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.k,{size:"sm"}),"جاري الحفظ..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"حفظ التغييرات"]})}),(0,o.jsx)("button",{type:"button",onClick:()=>r.back(),className:"flex-1 sm:flex-none border border-gray-300 hover:bg-gray-50 text-gray-700 py-3 px-6 rounded-lg transition-colors",children:"إلغاء"})]})]})})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[77,180,441,684,358],()=>r(213)),_N_E=e.O()}]);