(()=>{var e={};e.id=6437,e.ids=[6437],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{"use strict";e.exports=require("bcrypt")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},39591:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{POST:()=>c});var a=r(32190),n=r(64939),o=r(5486),i=r.n(o),u=e([n]);async function c(e){try{let{email:t,password:r}=await e.json(),s=new n.Client({connectionString:process.env.DATABASE_URL});await s.connect();try{let e=await s.query(`
        SELECT id, email, encrypted_password 
        FROM auth.users 
        WHERE email = $1;
      `,[t]);if(0===e.rows.length)return a.NextResponse.json({success:!1,error:"Invalid email or password"},{status:401});let n=e.rows[0];if(!await i().compare(r,n.encrypted_password))return a.NextResponse.json({success:!1,error:"Invalid email or password"},{status:401});let o=await s.query(`
        SELECT account_type, name 
        FROM users 
        WHERE id = $1;
      `,[n.id]);if(0===o.rows.length)return a.NextResponse.json({success:!1,error:"User profile not found"},{status:500});let u=o.rows[0],c="store"===u.account_type?"/store/dashboard":"user"===u.account_type||"client"===u.account_type?"/user/dashboard":"engineer"===u.account_type||"consultant"===u.account_type?"/dashboard/construction-data":"/",p=a.NextResponse.json({success:!0,redirectTo:c,user:{id:n.id,email:n.email,account_type:u.account_type,name:u.name}});return p.cookies.set("temp_auth_user",JSON.stringify({id:n.id,email:n.email,account_type:u.account_type,name:u.name}),{path:"/",maxAge:86400,httpOnly:!1,secure:!0,sameSite:"lax"}),p}finally{await s.end()}}catch(e){return a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}n=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},71927:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>c,routeModule:()=>p,serverHooks:()=>y,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var a=r(96559),n=r(48088),o=r(37719),i=r(39591),u=e([i]);i=(u.then?(await u)():u)[0];let p=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/login-db/route",pathname:"/api/auth/login-db",filename:"route",bundlePath:"app/api/auth/login-db/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\auth\\login-db\\route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:y}=p;function c(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}s()}catch(e){s(e)}})},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580],()=>r(71927));module.exports=s})();