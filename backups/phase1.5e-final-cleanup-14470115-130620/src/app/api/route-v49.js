(()=>{var e={};e.id=9043,e.ids=[9043],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},37611:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>w,routeModule:()=>m,serverHooks:()=>x,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>g});var r={};s.r(r),s.d(r,{GET:()=>d,POST:()=>p});var o=s(96559),n=s(48088),a=s(37719),i=s(32190),c=s(61223),u=s(44999),l=s(94929);async function p(e){try{let t=(0,u.cookies)(),s=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:{user:r}}=await s.auth.getUser();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});if((e.headers.get("content-type")||"").includes("multipart/form-data")){let t=(await e.formData()).get("file");if(!t)return i.NextResponse.json({error:"No file provided"},{status:400});let s=await l.Sm.processExcelFile(t,r.id);return i.NextResponse.json(s)}{let t=await e.json();switch(t.action){case"create_global_item":let s={barcode:t.barcode,name:t.name,description:t.description||"",category:t.category,brand:t.brand,image_url:t.image_url||""},o=await l.Sm.createGlobalItem(s);return i.NextResponse.json(o);case"add_to_store_inventory":let n={store_price:t.store_price,store_cost:t.store_cost,quantity:t.quantity,min_stock_level:t.min_stock_level,store_specific_notes:t.store_specific_notes||""},a=await l.Sm.addToStoreInventory(r.id,t.global_item_id,n);return i.NextResponse.json(a);default:return i.NextResponse.json({error:"Invalid action"},{status:400})}}}catch(e){return i.NextResponse.json({error:e instanceof Error?e.message:"An error occurred"},{status:500})}}async function d(e){try{let t=(0,u.cookies)(),s=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:{user:r}}=await s.auth.getUser();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let o=e.nextUrl.searchParams;if(o.has("action")&&"sessions"===o.get("action")){let e=await l.Sm.getImportSessions(r.id);return i.NextResponse.json({sessions:e})}if(!o.has("barcode"))return i.NextResponse.json({error:"Invalid request"},{status:400});{let e=o.get("barcode"),t=await l.Sm.searchByBarcode(e,r.id);return i.NextResponse.json(t)}}catch(e){return i.NextResponse.json({error:e instanceof Error?e.message:"An error occurred"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/excel-import/route",pathname:"/api/excel-import",filename:"route",bundlePath:"app/api/excel-import/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\excel-import\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:h,workUnitAsyncStorage:g,serverHooks:x}=m;function w(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:g})}},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},94929:(e,t,s)=>{"use strict";s.d(t,{Sm:()=>r});class r{async createSession(e,t){let s=this.generateSessionId(),r={id:s,filename:e,totalRows:t,processedRows:0,status:"pending",createdAt:new Date,errors:[]};return this.sessions.set(s,r),s}async getSession(e){return this.sessions.get(e)||null}async getAllSessions(){return Array.from(this.sessions.values()).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}async searchSessions(e){let t=(await this.getAllSessions()).filter(t=>t.filename.toLowerCase().includes(e.toLowerCase())||t.id.includes(e)||t.status.includes(e));return{sessions:t,total:t.length}}async deleteSession(e){return this.sessions.delete(e)}async processExcelFile(e,t){let s=this.sessions.get(t);if(!s)throw Error("Session not found");s.status="processing",this.sessions.set(t,s);try{let t=await this.parseExcelFile(e);await this.processData(t,s),s.status="completed",s.completedAt=new Date}catch(e){s.status="failed",s.errors.push({row:-1,column:"general",message:e instanceof Error?e.message:"Unknown error occurred"})}return this.sessions.set(t,s),s}async parseExcelFile(e){let t=(await e.text()).split("\n"),s=t[0]?.split(",")||[],r=[];for(let e=1;e<t.length;e++)if(t[e].trim()){let o=t[e].split(","),n={};s.forEach((e,t)=>{n[e.trim()]=o[t]?.trim()||""}),r.push(n)}return r}async processData(e,t){for(let s=0;s<e.length;s++){let r=e[s],o=s+2;try{await this.processRow(r,o,t),t.processedRows++}catch(e){t.errors.push({row:o,column:"general",message:e instanceof Error?e.message:"Failed to process row"})}this.sessions.set(t.id,{...t})}}async processRow(e,t,s){let r=this.validateRow(e,t);if(r.length>0)return void s.errors.push(...r);await new Promise(e=>setTimeout(e,10))}validateRow(e,t){let s=[];return e.name&&""!==e.name.trim()||s.push({row:t,column:"name",message:"Name is required",value:e.name}),e.email&&!this.isValidEmail(e.email)&&s.push({row:t,column:"email",message:"Invalid email format",value:e.email}),e.phone&&!this.isValidPhone(e.phone)&&s.push({row:t,column:"phone",message:"Invalid phone format",value:e.phone}),s}async getImportTemplates(){return["customers","products","orders","inventory","suppliers","employees"]}async generateTemplate(e){return({customers:"name,email,phone,company,address\nJohn Doe,john@example.com,+1234567890,Acme Corp,123 Main St",products:"sku,name,category,price,stock\nPROD001,Widget,Electronics,29.99,100",orders:"order_id,customer_email,product_sku,quantity,date\nORD001,john@example.com,PROD001,2,2024-02-15",inventory:"sku,current_stock,minimum_stock,location\nPROD001,100,10,Warehouse A",suppliers:"name,email,phone,products\nSupplier Inc,supplier@example.com,+1987654321,Electronics",employees:"name,email,department,position,salary\nJane Smith,jane@example.com,IT,Developer,75000"})[e]||"Invalid template type"}generateSessionId(){return"session_"+Date.now().toString(36)+Math.random().toString(36).substr(2)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPhone(e){return/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[-\s\(\)]/g,""))}async getImportStats(){let e=await this.getAllSessions();return{totalSessions:e.length,completedSessions:e.filter(e=>"completed"===e.status).length,failedSessions:e.filter(e=>"failed"===e.status).length,totalRowsProcessed:e.reduce((e,t)=>e+t.processedRows,0)}}constructor(){this.sessions=new Map}}new r},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4243,580,9398,1223,4999],()=>s(37611));module.exports=r})();