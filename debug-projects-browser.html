<!DOCTYPE html>
<html>
<head>
    <title>Debug Projects Issue</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Debug Projects Issue</h1>
    <div id="output"></div>
    
    <script>
        const { createClient } = supabase;
          const supabaseUrl = 'https://lqhopwohuddhapkhhikf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxaG9wd29odWRkaGFwa2hoaWtmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5Njc1NjQsImV4cCI6MjA1OTU0MzU2NH0.Zze96fAMkynERwRFhyMF-F6_ds5WcwGckLD0qGQD9JQ';
        
        const client = createClient(supabaseUrl, supabaseKey);
        
        function log(message) {
            console.log(message);
            document.getElementById('output').innerHTML += message + '<br>';
        }
        
        async function debugProjects() {
            log('üîç Starting browser-based debug...');
            
            try {
                // Check current session
                log('üìä Checking current session...');
                const { data: sessionData, error: sessionError } = await client.auth.getSession();
                
                if (sessionError) {
                    log('‚ùå Session error: ' + sessionError.message);
                    return;
                }
                
                if (!sessionData?.session?.user) {
                    log('‚ö†Ô∏è No active session found, attempting login...');
                    
                    const { data: loginData, error: loginError } = await client.auth.signInWithPassword({
                        email: 'user@user.com',
                        password: '123456'
                    });
                    
                    if (loginError) {
                        log('‚ùå Login failed: ' + loginError.message);
                        return;
                    }
                    
                    log('‚úÖ Login successful');
                } else {
                    log('‚úÖ Active session found');
                }
                
                // Get current user
                const { data: userData, error: userError } = await client.auth.getUser();
                
                if (userError || !userData?.user) {
                    log('‚ùå User verification failed: ' + (userError?.message || 'No user'));
                    return;
                }
                
                const userId = userData.user.id;
                log('üÜî Current user ID: ' + userId);
                log('üìß User email: ' + userData.user.email);
                
                // Test projects query directly
                log('üìã Querying projects...');
                const { data: projects, error: projectsError } = await client
                    .from('projects')
                    .select('*')
                    .eq('user_id', userId);
                
                if (projectsError) {
                    log('‚ùå Projects query error: ' + projectsError.message);
                    log('Error details: ' + JSON.stringify(projectsError));
                    return;
                }
                
                log('‚úÖ Projects query successful');
                log('üìä Projects found: ' + (projects?.length || 0));
                
                if (projects && projects.length > 0) {
                    log('üìã Sample project:');
                    log('   ID: ' + projects[0].id);
                    log('   Name: ' + projects[0].name);
                    log('   User ID: ' + projects[0].user_id);
                    log('   Created: ' + projects[0].created_at);
                }
                
                // Test the exact getRecentProjects logic
                log('üîç Testing getRecentProjects logic...');
                
                const PAGE_SIZE = 5;
                const page = 1;
                const start = (page - 1) * PAGE_SIZE;
                
                // Count query
                const { count, error: countError } = await client
                    .from('projects')
                    .select('*', { count: 'exact', head: true })
                    .eq('user_id', userId);
                
                log('üìä Count query result: ' + count + ', Error: ' + (countError?.message || 'None'));
                
                // Paginated query
                const { data: paginatedProjects, error: paginatedError } = await client
                    .from('projects')
                    .select('*')
                    .eq('user_id', userId)
                    .order('created_at', { ascending: false })
                    .range(start, start + PAGE_SIZE - 1);
                
                log('üìã Paginated query result: ' + (paginatedProjects?.length || 0) + ' projects');
                log('Error: ' + (paginatedError?.message || 'None'));
                
                const result = {
                    items: paginatedProjects || [],
                    hasMore: count ? start + PAGE_SIZE < count : false,
                    total: count || 0,
                    page,
                };
                
                log('‚úÖ Final result: ' + JSON.stringify(result, null, 2));
                
            } catch (error) {
                log('üí• Unexpected error: ' + error.message);
                console.error('Full error:', error);
            }
        }
        
        // Auto-run on page load
        window.onload = debugProjects;
    </script>
</body>
</html>
