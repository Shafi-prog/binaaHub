# ๐ ุชูุซูู ุชุฏูู ุงูุจูุงูุงุช - ููุตุฉ ุจูุงุก ูุจ

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 12 ุฃุบุณุทุณ 2025  
**ุงููุณุฎุฉ:** 1.0  
**ุงููุบุฉ:** ุงูุนุฑุจูุฉ  

---

## ๐ฏ ุงููุฏู ูู ูุฐุง ุงูุชูุซูู

ููุฏู ูุฐุง ุงูููู ุฅูู ุชูุซูู ุชุฏูู ุงูุจูุงูุงุช ุจูู ุงููุทุงูุงุช ุงููุฎุชููุฉ ูู ููุตุฉ ุจูุงุก ูุจุ ูุชูุถูุญ ููููุฉ ุชูุงุนู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุน ุงูุฎูููุฉุ ูุถูุงู ุชูุงูู ุงูุจูุงูุงุช ุนุจุฑ ุฌููุน ุฃุฌุฒุงุก ุงููุธุงู.

---

## ๐๏ธ ูุนูุงุฑูุฉ ุงููุธุงู

### ุงููุทุงูุงุช ุงูุฃุณุงุณูุฉ (Core Domains)

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   ๐ฅ ุงููุณุชุฎุฏููู   โ    โ   ๐ช ุงููุชุฌุฑ      โ    โ   ๐๏ธ ุงููุดุงุฑูุน    โ
โ   (Users)       โ    โ (Marketplace)   โ    โ (Construction)  โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
        โ                       โ                       โ
        โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   ๐ผ ERP        โ    โ   ๐ฆ ุงููุฎุฒูู      โ    โ   ๐ฐ ุงููุฏููุนุงุช    โ
โ   (Enterprise)  โ    โ  (Inventory)    โ    โ   (Payments)    โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ ูุนูุงูุงุชูุง

### 1. ูุทุงู ุงููุณุชุฎุฏููู (Users Domain)

#### ุฃ) ุฌุฏูู ุงููููุงุช ุงูุดุฎุตูุฉ `user_profiles`
```sql
user_profiles {
  id: UUID (Primary Key)
  user_id: String (Unique)
  email: String
  display_name: String
  phone: String
  account_type: Enum (admin, user, store_owner, supplier)
  loyalty_points: Integer
  total_spent: Decimal
  created_at: Timestamp
}
```

**ุงูุนูุงูุงุช:**
- โ `construction_projects` (one-to-many)
- โ `orders` (one-to-many)
- โ `service_providers` (one-to-one for suppliers)

### 2. ูุทุงู ุงููุดุงุฑูุน (Construction Domain)

#### ุฃ) ุฌุฏูู ุงููุดุงุฑูุน `construction_projects`
```sql
construction_projects {
  id: UUID (Primary Key)
  user_id: String โ user_profiles.user_id
  project_name: String
  description: Text
  location: String
  estimated_cost: Decimal
  spent_cost: Decimal
  status: Enum (planning, active, completed, cancelled)
  created_at: Timestamp
}
```

**ุงูุนูุงูุงุช:**
- โ `user_profiles` (many-to-one)
- โ `orders` (one-to-many ุนุจุฑ project_id)
- โ `project_budgets` (one-to-many)

### 3. ูุทุงู ุงููุชุฌุฑ (Marketplace Domain)

#### ุฃ) ุฌุฏูู ุงูููุชุฌุงุช `products`
```sql
products {
  id: UUID (Primary Key)
  name: String
  description: Text
  price: Decimal
  stock_quantity: Integer
  category_id: UUID
  supplier_id: UUID โ service_providers.id
  status: Enum (active, inactive, out_of_stock)
  created_at: Timestamp
}
```

#### ุจ) ุฌุฏูู ุงูุทูุจุงุช `orders`
```sql
orders {
  id: UUID (Primary Key)
  user_id: String โ user_profiles.user_id
  project_id: UUID โ construction_projects.id (Optional)
  total_amount: Decimal
  status: Enum (pending, processing, shipped, delivered, cancelled)
  shipping_address: Text
  created_at: Timestamp
}
```

#### ุฌ) ุฌุฏูู ุนูุงุตุฑ ุงูุทูุจ `order_items`
```sql
order_items {
  id: UUID (Primary Key)
  order_id: UUID โ orders.id
  product_id: UUID โ products.id
  quantity: Integer
  unit_price: Decimal
  total_price: Decimal
}
```

### 4. ูุทุงู ููุฏูู ุงูุฎุฏูุฉ `service_providers`
```sql
service_providers {
  id: UUID (Primary Key)
  user_id: String โ user_profiles.user_id
  company_name: String
  specialization: String
  experience_years: Integer
  verification_status: Enum (pending, verified, rejected)
  rating: Decimal
}
```

---

## ๐ ุชุฏูู ุงูุจูุงูุงุช - ุงูุณููุงุฑูููุงุช ุงูุฃุณุงุณูุฉ

### ุณููุงุฑูู 1: ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ

```mermaid
sequenceDiagram
    participant U as ๐ค ุงููุณุชุฎุฏู
    participant F as ๐ฅ๏ธ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
    participant A as ๐ API
    participant D as ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

    U->>F: ุฅุฏุฎุงู ุจูุงูุงุช ุงูุชุณุฌูู
    F->>A: POST /api/auth/register
    A->>D: INSERT INTO user_profiles
    D-->>A: ุฅุฑุฌุงุน user_id
    A-->>F: ุฅุฑุฌุงุน ุฑูุฒ ุงููุตุงุฏูุฉ
    F-->>U: ุชุฃููุฏ ุงูุชุณุฌูู + ุชุญููู ูููุญุฉ ุงูุชุญูู
```

**ุงูุฎุทูุงุช ุงูุชูุตูููุฉ:**
1. **ุฌูุน ุงูุจูุงูุงุช**: ุงูุงุณูุ ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ูููุฉ ุงููุฑูุฑุ ููุน ุงูุญุณุงุจ
2. **ุงูุชุญูู**: ูุญุต ุตุญุฉ ุงูุจูุงูุงุช ุนูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
3. **ุงูุฅุฑุณุงู**: ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู `/api/auth/register`
4. **ุงููุนุงูุฌุฉ**: ุชุดููุฑ ูููุฉ ุงููุฑูุฑ ูุฅูุดุงุก ุงูุณุฌู
5. **ุงูุฑุฏ**: ุฅุฑุฌุงุน ุฑูุฒ ุงููุตุงุฏูุฉ ูุชูุฌูู ุงููุณุชุฎุฏู

### ุณููุงุฑูู 2: ุฅูุดุงุก ูุดุฑูุน ุฅูุดุงุฆู

```mermaid
sequenceDiagram
    participant U as ๐ค ุงููุณุชุฎุฏู
    participant F as ๐ฅ๏ธ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
    participant A as ๐ API
    participant D as ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

    U->>F: ููุก ูููุฐุฌ ุงููุดุฑูุน
    F->>A: POST /api/projects
    A->>D: INSERT INTO construction_projects
    A->>D: CREATE project_budget record
    A->>D: UPDATE user_profiles (project_count++)
    D-->>A: ุชุฃููุฏ ุงูุฅูุดุงุก
    A-->>F: ุฅุฑุฌุงุน ูุนุฑู ุงููุดุฑูุน
    F-->>U: ุนุฑุถ ุตูุญุฉ ุงููุดุฑูุน ุงูุฌุฏูุฏ
```

**ุงูุจูุงูุงุช ุงููุทููุจุฉ:**
- ุงุณู ุงููุดุฑูุน
- ุงููุตู
- ุงููููุน
- ุงูุชูููุฉ ุงูููุฏุฑุฉ
- ุชุงุฑูุฎ ุงูุจุฏุก ุงููุชููุน

**ุงูุชุญุฏูุซุงุช ุงูุชููุงุฆูุฉ:**
- ุฅูุดุงุก ููุฒุงููุฉ ุฃูููุฉ ูููุดุฑูุน
- ุชุญุฏูุซ ุนุฏุฏ ุงููุดุงุฑูุน ูููุณุชุฎุฏู
- ุฅูุดุงุก ููุงู ุฃุณุงุณูุฉ ูููุดุฑูุน

### ุณููุงุฑูู 3: ุชุตูุญ ูุดุฑุงุก ุงูููุชุฌุงุช

```mermaid
sequenceDiagram
    participant U as ๐ค ุงููุณุชุฎุฏู
    participant F as ๐ฅ๏ธ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
    participant A as ๐ API
    participant D as ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

    U->>F: ุชุตูุญ ุงูููุชุฌุงุช
    F->>A: GET /api/products
    A->>D: SELECT FROM products WHERE status='active'
    D-->>A: ูุงุฆูุฉ ุงูููุชุฌุงุช
    A-->>F: ุฅุฑุฌุงุน ุงูุจูุงูุงุช
    F-->>U: ุนุฑุถ ุงูููุชุฌุงุช

    U->>F: ุฅุถุงูุฉ ููุชุฌ ููุณูุฉ
    F->>F: ุญูุธ ูู localStorage
    
    U->>F: ุงูุงูุชูุงู ููุฏูุน
    F->>A: POST /api/orders/create
    A->>D: INSERT INTO orders
    A->>D: INSERT INTO order_items
    A->>D: UPDATE products (stock_quantity--)
    A->>D: UPDATE user_profiles (total_spent++)
    A->>D: UPDATE construction_projects (spent_cost++) IF project_id
    D-->>A: ุชุฃููุฏ ุงูุทูุจ
    A-->>F: ุฅุฑุฌุงุน ุฑูู ุงูุทูุจ
    F-->>U: ุนุฑุถ ุชุฃููุฏ ุงูุทูุจ
```

**ุชูุงุตูู ุงูุนูููุฉ:**

#### ุฃ) ุชุญููู ุงูููุชุฌุงุช
- **ุงููุตุฏุฑ**: ุฌุฏูู `products`
- **ุงูุชุตููุฉ**: ุญุณุจ ุงููุฆุฉุ ุงูุณุนุฑุ ุงูุชููุฑ
- **ุงูุชุฑุชูุจ**: ุญุณุจ ุงูุดุนุจูุฉ ุฃู ุงูุชุงุฑูุฎ
- **ุงูุชุฎุฒูู ุงููุคูุช**: ุงุณุชุฎุฏุงู cache ููุฃุฏุงุก

#### ุจ) ุฅุฏุงุฑุฉ ุงูุณูุฉ
- **ุงูุชุฎุฒูู**: localStorage ููุฌูุณุฉ ุงูุญุงููุฉ
- **ุงูุชุญุฏูุซ**: ุชุญุฏูุซ ููุฑู ูููููุงุช ูุงูุฃุณุนุงุฑ
- **ุงูุชุญูู**: ูุญุต ุชููุฑ ุงูููุชุฌุงุช ูุจู ุงูุฏูุน

#### ุฌ) ูุนุงูุฌุฉ ุงูุทูุจ
```typescript
// ุฎุทูุงุช ูุนุงูุฌุฉ ุงูุทูุจ
1. ุงูุชุญูู ูู ุจูุงูุงุช ุงููุณุชุฎุฏู ูุงูุนููุงู
2. ุญุณุงุจ ุงููุฌููุน ุงูููู ูุงูุถุฑุงุฆุจ
3. ูุญุต ุชููุฑ ุฌููุน ุงูููุชุฌุงุช
4. ุฅูุดุงุก ุณุฌู ุงูุทูุจ ุงูุฑุฆูุณู
5. ุฅูุดุงุก ุณุฌูุงุช ุนูุงุตุฑ ุงูุทูุจ
6. ุชุญุฏูุซ ูููุงุช ุงููุฎุฒูู
7. ุฑุจุท ุงูุทูุจ ุจุงููุดุฑูุน (ุฅู ููุฌุฏ)
8. ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
9. ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุงูุชุฃููุฏ
```

### ุณููุงุฑูู 4: ุฑุจุท ุงูุทูุจ ุจุงููุดุฑูุน

```mermaid
flowchart TD
    A[๐ค ุงููุณุชุฎุฏู ูุฎุชุงุฑ ููุชุฌุงุช] --> B[๐ ุฅุถุงูุฉ ููุณูุฉ]
    B --> C{๐ ูู ูุฑูุฏ ุฑุจุท ุจูุดุฑูุนุ}
    C -->|ูุนู| D[๐ ุงุฎุชูุงุฑ ุงููุดุฑูุน]
    C -->|ูุง| E[๐ณ ุฏูุน ุนุงุฏู]
    D --> F[๐ ุฑุจุท ุงูุทูุจ ุจุงููุดุฑูุน]
    F --> G[๐ฐ ุฎุตู ูู ููุฒุงููุฉ ุงููุดุฑูุน]
    G --> H[๐ ุชุญุฏูุซ ุชูุงุฑูุฑ ุงููุดุฑูุน]
    E --> I[๐ณ ุฏูุน ุจุฏูู ุฑุจุท]
    H --> J[โ ุชุฃููุฏ ุงูุทูุจ]
    I --> J
```

**ููุงุฆุฏ ุงูุฑุจุท:**
- ุชุชุจุน ุชูุงููู ุงููุดุฑูุน
- ุชุญุฏูุซ ุงูููุฒุงููุฉ ุงูููููุฉ
- ุชูุงุฑูุฑ ููุตูุฉ ูููุดุฑูุน
- ุชุญููู ุงูุชูุงููู ุจุงููุฆุงุช

---

## ๐ ุงูุนูููุงุช ุงููุชูุฏูุฉ

### 1. ุชูุงูู ุงูุจูุงูุงุช ุนุจุฑ ุงููุทุงูุงุช

#### ุฃ) ูุฒุงููุฉ ููุงุท ุงูููุงุก
```typescript
async function updateLoyaltyPoints(userId: string, orderAmount: number) {
  // 1. ุญุณุงุจ ุงูููุงุท ุงููุณุชุญูุฉ (1 ููุทุฉ ููู 10 ุฑูุงู)
  const earnedPoints = Math.floor(orderAmount / 10);
  
  // 2. ุชุญุฏูุซ ุฑุตูุฏ ุงูููุงุท
  await supabase
    .from('user_profiles')
    .update({ 
      loyalty_points: loyalty_points + earnedPoints,
      total_spent: total_spent + orderAmount 
    })
    .eq('user_id', userId);
  
  // 3. ุชุณุฌูู ุญุฑูุฉ ุงูููุงุท
  await supabase
    .from('loyalty_transactions')
    .insert({
      user_id: userId,
      points: earnedPoints,
      type: 'earned',
      source: 'purchase',
      order_id: orderId
    });
}
```

#### ุจ) ุชุญุฏูุซ ููุฒุงููุฉ ุงููุดุฑูุน
```typescript
async function updateProjectBudget(projectId: string, orderAmount: number) {
  // 1. ุฌูุจ ุงูููุฒุงููุฉ ุงูุญุงููุฉ
  const { data: project } = await supabase
    .from('construction_projects')
    .select('estimated_cost, spent_cost')
    .eq('id', projectId)
    .single();
  
  // 2. ุชุญุฏูุซ ุงููุจูุบ ุงููููู
  const newSpentCost = project.spent_cost + orderAmount;
  
  // 3. ูุญุต ุชุฌุงูุฒ ุงูููุฒุงููุฉ
  const budgetExceeded = newSpentCost > project.estimated_cost;
  
  // 4. ุงูุชุญุฏูุซ ูุน ุชุณุฌูู ุงูุชุญุฐูุฑ
  await supabase
    .from('construction_projects')
    .update({ 
      spent_cost: newSpentCost,
      budget_status: budgetExceeded ? 'exceeded' : 'within_budget'
    })
    .eq('id', projectId);
  
  // 5. ุฅุฑุณุงู ุชูุจูู ุฅุฐุง ุชู ุชุฌุงูุฒ ุงูููุฒุงููุฉ
  if (budgetExceeded) {
    await sendBudgetExceededNotification(projectId);
  }
}
```

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงูุงุณุชุซูุงุกุงุช

#### ุฃ) ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ
```typescript
async function retryOperation<T>(
  operation: () => Promise<T>, 
  maxRetries: number = 3
): Promise<T> {
  let lastError: Error;
  
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await operation();
    } catch (error) {
      lastError = error;
      console.log(`ุงููุญุงููุฉ ${attempt} ูุดูุช:`, error.message);
      
      if (attempt < maxRetries) {
        // ุงูุชุธุงุฑ ุชุฏุฑูุฌู (exponential backoff)
        await new Promise(resolve => 
          setTimeout(resolve, Math.pow(2, attempt) * 1000)
        );
      }
    }
  }
  
  throw lastError;
}
```

#### ุจ) ุงูุชุญูู ูู ุชูุงูู ุงูุจูุงูุงุช
```typescript
async function validateDataIntegrity(userId: string) {
  const issues = [];
  
  // 1. ุงูุชุญูู ูู ุชุทุงุจู ูุฌููุน ุงูุทูุจุงุช ูุน ุงููุจูุบ ุงููููู
  const { data: orders } = await supabase
    .from('orders')
    .select('total_amount')
    .eq('user_id', userId);
  
  const { data: user } = await supabase
    .from('user_profiles')
    .select('total_spent')
    .eq('user_id', userId)
    .single();
  
  const calculatedTotal = orders.reduce((sum, order) => sum + order.total_amount, 0);
  
  if (Math.abs(calculatedTotal - user.total_spent) > 0.01) {
    issues.push({
      type: 'ูุฌููุน_ุงูุทูุจุงุช_ุบูุฑ_ูุชุทุงุจู',
      expected: calculatedTotal,
      actual: user.total_spent
    });
  }
  
  // 2. ุงูุชุญูู ูู ุชุทุงุจู ุงููุฎุฒูู
  // ... ุงููุฒูุฏ ูู ูุญูุตุงุช ุงูุชูุงูู
  
  return {
    isValid: issues.length === 0,
    issues
  };
}
```

---

## ๐ ุชูุงุฑูุฑ ูุชุญูููุงุช ุงูุจูุงูุงุช

### 1. ุชูุฑูุฑ ุฃุฏุงุก ุงููุดุฑูุน

```sql
-- ุงุณุชุนูุงู ุชูุฑูุฑ ุงููุดุฑูุน ุงูุดุงูู
SELECT 
  cp.project_name,
  cp.estimated_cost,
  cp.spent_cost,
  (cp.spent_cost / cp.estimated_cost * 100) as budget_usage_percentage,
  COUNT(o.id) as total_orders,
  SUM(oi.quantity) as total_items_purchased,
  AVG(o.total_amount) as average_order_value
FROM construction_projects cp
LEFT JOIN orders o ON cp.id = o.project_id
LEFT JOIN order_items oi ON o.id = oi.order_id
WHERE cp.user_id = $1
GROUP BY cp.id, cp.project_name, cp.estimated_cost, cp.spent_cost
ORDER BY cp.created_at DESC;
```

### 2. ุชูุฑูุฑ ุฃุฏุงุก ุงููุชุฌุฑ

```sql
-- ุงุณุชุนูุงู ุฃูุถู ุงูููุชุฌุงุช ูุจูุนุงู
SELECT 
  p.name,
  p.price,
  SUM(oi.quantity) as total_sold,
  SUM(oi.total_price) as total_revenue,
  COUNT(DISTINCT oi.order_id) as unique_orders
FROM products p
JOIN order_items oi ON p.id = oi.product_id
JOIN orders o ON oi.order_id = o.id
WHERE o.created_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY p.id, p.name, p.price
ORDER BY total_revenue DESC
LIMIT 10;
```

---

## ๐ ุงูุฃูุงู ูุญูุงูุฉ ุงูุจูุงูุงุช

### 1. Row Level Security (RLS)

#### ุฃ) ุณูุงุณุฉ ุงููููุงุช ุงูุดุฎุตูุฉ
```sql
-- ุงููุณุชุฎุฏููู ูููููู ุงููุตูู ููููุงุชูู ุงูุดุฎุตูุฉ ููุท
CREATE POLICY "ุงููุณุชุฎุฏููู ูุฑูู ูููุงุชูู ููุท" ON user_profiles
FOR ALL 
TO authenticated
USING (auth.uid()::text = user_id);
```

#### ุจ) ุณูุงุณุฉ ุงููุดุงุฑูุน
```sql
-- ุงููุณุชุฎุฏููู ูููููู ุงููุตูู ููุดุงุฑูุนูู ููุท
CREATE POLICY "ุฃุตุญุงุจ ุงููุดุงุฑูุน ููุท" ON construction_projects
FOR ALL 
TO authenticated  
USING (auth.uid()::text = user_id);
```

#### ุฌ) ุณูุงุณุฉ ุงูุทูุจุงุช
```sql
-- ุงููุณุชุฎุฏููู ูุฑูู ุทูุจุงุชูู + ุงููุฏุฑุงุก ูุฑูู ูู ุดูุก
CREATE POLICY "ุทูุจุงุช ุงููุณุชุฎุฏู ุฃู ุงููุฏุฑุงุก" ON orders
FOR SELECT 
TO authenticated
USING (
  auth.uid()::text = user_id 
  OR 
  EXISTS (
    SELECT 1 FROM user_profiles 
    WHERE user_id = auth.uid()::text 
    AND account_type = 'admin'
  )
);
```

### 2. ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช

```typescript
// ูุซุงู ุนูู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
const projectValidationSchema = {
  project_name: {
    required: true,
    minLength: 3,
    maxLength: 100,
    pattern: /^[a-zA-Zุฃ-ู\s0-9]+$/
  },
  estimated_cost: {
    required: true,
    type: 'number',
    min: 1000,
    max: 10000000
  },
  location: {
    required: true,
    minLength: 5,
    maxLength: 200
  }
};
```

---

## ๐ ุงูุฃุฏุงุก ูุงูุชุญุณููุงุช

### 1. ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฎุฒูู ุงููุคูุช

#### ุฃ) ุชุฎุฒูู ูุคูุช ููููุชุฌุงุช
```typescript
// Cache ููููุชุฌุงุช ููุฏุฉ 15 ุฏูููุฉ
const getCachedProducts = async (category?: string) => {
  const cacheKey = `products_${category || 'all'}`;
  const cached = await redis.get(cacheKey);
  
  if (cached) {
    return JSON.parse(cached);
  }
  
  const products = await supabase
    .from('products')
    .select('*')
    .eq('status', 'active')
    .eq(category ? 'category_id' : '', category || '');
  
  await redis.setex(cacheKey, 900, JSON.stringify(products.data));
  return products.data;
};
```

#### ุจ) ุชุฎุฒูู ูุคูุช ูุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
```typescript
// Cache ูุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู ููุฏุฉ 5 ุฏูุงุฆู
const getUserStats = async (userId: string) => {
  const cacheKey = `user_stats_${userId}`;
  const cached = await redis.get(cacheKey);
  
  if (cached) {
    return JSON.parse(cached);
  }
  
  const stats = await calculateUserStats(userId);
  await redis.setex(cacheKey, 300, JSON.stringify(stats));
  return stats;
};
```

### 2. ุชุญุณูู ุงูุงุณุชุนูุงูุงุช

#### ุฃ) ุงุณุชุฎุฏุงู ุงูููุงุฑุณ
```sql
-- ููุงุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_project_id ON orders(project_id);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_products_category ON products(category_id, status);
CREATE INDEX idx_user_profiles_account_type ON user_profiles(account_type);
```

#### ุจ) ุงุณุชุนูุงูุงุช ูุญุณููุฉ
```sql
-- ุงุณุชุนูุงู ูุญุณูู ูุฌูุจ ุจูุงูุงุช ุงููุดุฑูุน ูุน ุงูุทูุจุงุช
SELECT 
  cp.*,
  COALESCE(project_orders.order_count, 0) as order_count,
  COALESCE(project_orders.total_spent, 0) as actual_spent
FROM construction_projects cp
LEFT JOIN LATERAL (
  SELECT 
    COUNT(*) as order_count,
    SUM(total_amount) as total_spent
  FROM orders o 
  WHERE o.project_id = cp.id
) project_orders ON true
WHERE cp.user_id = $1;
```

---

## ๐ ุณููุงุฑูููุงุช ุงููุนุงูุฌุฉ ุงููุชูุฏูุฉ

### 1. ูุนุงูุฌุฉ ุงูุทูุจุงุช ุงููุชุฒุงููุฉ

```typescript
async function handleConcurrentOrders(productId: string, requestedQuantity: number) {
  // 1. ููู ุงูููุชุฌ ููุชุญุฏูุซ
  const { data: product, error } = await supabase
    .from('products')
    .select('stock_quantity')
    .eq('id', productId)
    .single();

  if (error) throw new Error('ูุดู ูู ุฌูุจ ุจูุงูุงุช ุงูููุชุฌ');

  // 2. ูุญุต ุงููููุฉ ุงููุชุงุญุฉ
  if (product.stock_quantity < requestedQuantity) {
    throw new Error(`ุงููููุฉ ุงููุทููุจุฉ (${requestedQuantity}) ุฃูุจุฑ ูู ุงููุชุงุญ (${product.stock_quantity})`);
  }

  // 3. ุชุญุฏูุซ ุงููุฎุฒูู ุจุดูู ุขูู
  const { error: updateError } = await supabase
    .from('products')
    .update({ 
      stock_quantity: product.stock_quantity - requestedQuantity 
    })
    .eq('id', productId)
    .eq('stock_quantity', product.stock_quantity); // Optimistic locking

  if (updateError) {
    throw new Error('ูุดู ูู ุชุญุฏูุซ ุงููุฎุฒูู - ูุฏ ูููู ููุงู ุทูุจ ูุชุฒุงูู ุขุฎุฑ');
  }

  return true;
}
```

### 2. ูุฒุงููุฉ ุงูุจูุงูุงุช ูู ุงูููุช ุงููุนูู

```typescript
// WebSocket ููุชุญุฏูุซุงุช ุงูููุฑูุฉ
const setupRealTimeUpdates = (userId: string) => {
  const channel = supabase
    .channel(`user_${userId}`)
    .on('postgres_changes', 
      { 
        event: 'UPDATE', 
        schema: 'public', 
        table: 'orders',
        filter: `user_id=eq.${userId}` 
      },
      (payload) => {
        // ุชุญุฏูุซ ุงููุงุฌูุฉ ููุฑุงู ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ
        updateOrderStatus(payload.new);
      }
    )
    .on('postgres_changes',
      {
        event: 'INSERT',
        schema: 'public', 
        table: 'order_items',
        filter: `order_id=in.(${userOrderIds.join(',')})`
      },
      (payload) => {
        // ุชุญุฏูุซ ุนูุงุตุฑ ุงูุทูุจ ููุฑุงู
        addOrderItem(payload.new);
      }
    )
    .subscribe();

  return channel;
};
```

---

## ๐ ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ ููุชุทููุฑ

### โ ุชู ุฅูุฌุงุฒู
- [x] ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ
- [x] ุชุทููุฑ APIs ููุนูููุงุช ุงูุฃุณุงุณูุฉ (CRUD)
- [x] ุชุทููุฑ ูุงุฌูุงุช ุงููุณุชุฎุฏู ููููููุงุช ุงูุฃุณุงุณูุฉ
- [x] ุชุทุจูู Row Level Security (RLS)
- [x] ุฅุนุฏุงุฏ ุงุฎุชุจุงุฑุงุช ุงููุญุฏุฉ ูุงูุชูุงูู
- [x] ุชุทููุฑ ุฎุฏูุฉ ุชูุงูู ุงูุจูุงูุงุช
- [x] ุฅุนุฏุงุฏ ูุฑุงูุจุฉ ุณูุงูุฉ ุงููุธุงู

### ๐ ููุฏ ุงูุชุทููุฑ
- [ ] ุชุญุณูู ุนุฑุถ ุงูููุชุฌุงุช ูู ุงููุงุฌูุฉ
- [ ] ุชุทููุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ
- [ ] ุชุญุณูู ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ
- [ ] ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงุฎุชุจุงุฑุงุช E2E

### ๐ ูุฎุทุท ูููุณุชูุจู
- [ ] ุชุทููุฑ ุชุทุจูู ุฌูุงู
- [ ] ุฅุถุงูุฉ ุฏุนู ููุฏูุน ุงูุฅููุชุฑููู
- [ ] ุชุทููุฑ ูุธุงู ุชุญูููุงุช ูุชูุฏู
- [ ] ุฅุถุงูุฉ ุฏุนู ููุฐูุงุก ุงูุงุตุทูุงุนู

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

### ูููุทูุฑูู
- **ุงูุชูุซูู ุงูุชููู**: `/docs/technical/`
- **API Documentation**: `/docs/api/`
- **Testing Guide**: `/docs/testing/`

### ููุฑูู ุงูุฌูุฏุฉ
- **Test Cases**: `/tests/`
- **Performance Benchmarks**: `/docs/performance/`
- **Security Guidelines**: `/docs/security/`

### ููุฅุฏุงุฑุฉ
- **Business Logic Documentation**: ูุฐุง ุงูููู
- **User Flows**: `/docs/user-flows/`
- **Analytics Reports**: `/docs/analytics/`

---

*ุขุฎุฑ ุชุญุฏูุซ: 12 ุฃุบุณุทุณ 2025*  
*ุงูุฅุตุฏุงุฑ: 1.0*  
*ุงููุณุคูู: GitHub Copilot*
