<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุงุฎุชุจุงุฑ ุฅุตูุงุญ ูุดุงูู ุงููุตุงุฏูุฉ</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
        direction: rtl;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        background: #f8f9fa;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
      .success {
        border-left-color: #28a745;
        background: #d4edda;
      }
      .error {
        border-left-color: #dc3545;
        background: #f8d7da;
      }
      .warning {
        border-left-color: #ffc107;
        background: #fff3cd;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin: 10px 0;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>๐ง ุงุฎุชุจุงุฑ ุฅุตูุงุญ ูุดุงูู ุงููุตุงุฏูุฉ</h1>
      <p>ูุฐุง ุงูุงุฎุชุจุงุฑ ูุชุญูู ูู ุญู ูุดุงูู "ุฎุทุฃ ูู ุงููุตุงุฏูุฉ" ู "ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุงูุฏุฎูู"</p>

      <div class="test-section">
        <h3>1๏ธโฃ ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู</h3>
        <button onclick="testLogin()">ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู</button>
      </div>

      <div class="test-section">
        <h3>2๏ธโฃ ุงุฎุชุจุงุฑ ุงููุตูู ููุตูุญุงุช ุงููุญููุฉ</h3>
        <button onclick="testProtectedRoutes()">ุงุฎุชุจุงุฑ ุงููุณุงุฑุงุช ุงููุญููุฉ</button>
      </div>

      <div class="test-section">
        <h3>3๏ธโฃ ุงุฎุชุจุงุฑ ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ</h3>
        <button onclick="testNewProject()">ุงุฎุชุจุงุฑ "new project"</button>
      </div>
      <div class="test-section">
        <h3>4๏ธโฃ ุงุฎุชุจุงุฑ ุงูููู ุงูุดุฎุตู</h3>
        <button onclick="testUserProfile()">ุงุฎุชุจุงุฑ ุตูุญุฉ ุงูููู ุงูุดุฎุตู</button>
      </div>

      <div class="test-section">
        <h3>5๏ธโฃ ุงุฎุชุจุงุฑ ููุญุฉ ุชุญูู ุงููุชุฌุฑ</h3>
        <button onclick="testStoreDashboard()">ุงุฎุชุจุงุฑ ููุญุฉ ุชุญูู ุงููุชุฌุฑ</button>
      </div>

      <div class="test-section">
        <h3>6๏ธโฃ ุงุฎุชุจุงุฑ ุดุงูู</h3>
        <button onclick="runFullTest()">ุชุดุบูู ุงูุงุฎุชุจุงุฑ ุงูุดุงูู</button>
        <button onclick="clearLog()">ูุณุญ ุงูุณุฌู</button>
      </div>

      <div id="log" class="log"></div>
    </div>

    <script>
      function log(message, type = 'info') {
        const logDiv = document.getElementById('log');
        const timestamp = new Date().toLocaleTimeString('ar-SA');
        const colors = {
          info: '#007bff',
          success: '#28a745',
          error: '#dc3545',
          warning: '#ffc107',
        };
        logDiv.innerHTML += `<div style="color: ${colors[type] || colors.info};">[${timestamp}] ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function clearLog() {
        document.getElementById('log').innerHTML = '';
      }

      async function testLogin() {
        log('๐ ุจุฏุก ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู...', 'info');

        try {
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: 'user@user.com',
              password: '123456',
            }),
            credentials: 'include',
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const result = await response.json();

          if (result.success) {
            log(`โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ ูููุณุชุฎุฏู: ${result.user.email}`, 'success');
            log(`๐ฏ ุตูุญุฉ ุงูุชูุฌูู: ${result.redirectTo}`, 'info');

            // Store login status for other tests
            window.userLoggedIn = true;
            window.userEmail = result.user.email;
          } else {
            log(`โ ูุดู ุชุณุฌูู ุงูุฏุฎูู: ${result.error}`, 'error');
          }
        } catch (error) {
          log(`โ ุฎุทุฃ ูู ุชุณุฌูู ุงูุฏุฎูู: ${error.message}`, 'error');
        }
      }

      async function testProtectedRoutes() {
        log('๐ ุงุฎุชุจุงุฑ ุงููุตูู ูููุณุงุฑุงุช ุงููุญููุฉ...', 'info');
        const routes = [
          '/user/dashboard',
          '/user/profile',
          '/user/projects',
          '/user/projects/new',
          '/user/orders',
          '/store/dashboard',
        ];

        for (const route of routes) {
          try {
            log(`๐ ุงุฎุชุจุงุฑ ุงููุณุงุฑ: ${route}`, 'info');

            const response = await fetch(route, {
              credentials: 'include',
              redirect: 'manual',
            });

            if (response.status === 200) {
              log(`โ ${route} - ุงููุตูู ูุชุงุญ`, 'success');
            } else if (response.status === 302 || response.status === 307) {
              const redirectLocation = response.headers.get('location');
              if (redirectLocation && redirectLocation.includes('/login')) {
                log(`โ ${route} - ุชู ุงูุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู`, 'error');
              } else {
                log(`๐ ${route} - ุชูุฌูู ุฅูู: ${redirectLocation}`, 'warning');
              }
            } else {
              log(`โ๏ธ ${route} - ุญุงูุฉ ุบูุฑ ูุชููุนุฉ: ${response.status}`, 'warning');
            }
          } catch (error) {
            log(`โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ${route}: ${error.message}`, 'error');
          }

          // Small delay between requests
          await new Promise((resolve) => setTimeout(resolve, 500));
        }
      }

      async function testNewProject() {
        log('๐ ุงุฎุชุจุงุฑ ุตูุญุฉ ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ...', 'info');

        try {
          const response = await fetch('/user/projects/new', {
            credentials: 'include',
            redirect: 'manual',
          });

          if (response.status === 200) {
            log('โ ุตูุญุฉ ุฅูุดุงุก ุงููุดุฑูุน ูุชุงุญุฉ - ุชู ุญู ูุดููุฉ "ุฎุทุฃ ูู ุงููุตุงุฏูุฉ"', 'success');
          } else if (response.status === 302 || response.status === 307) {
            const redirectLocation = response.headers.get('location');
            if (redirectLocation && redirectLocation.includes('/login')) {
              log('โ ูุง ูุฒุงู ููุงู ูุดููุฉ - ูุชู ุงูุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู', 'error');
            } else {
              log(`๐ ุชูุฌูู ุฅูู: ${redirectLocation}`, 'warning');
            }
          }
        } catch (error) {
          log(`โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุตูุญุฉ ุงููุดุฑูุน ุงูุฌุฏูุฏ: ${error.message}`, 'error');
        }
      }

      async function testUserProfile() {
        log('๐ค ุงุฎุชุจุงุฑ ุตูุญุฉ ุงูููู ุงูุดุฎุตู...', 'info');

        try {
          const response = await fetch('/user/profile', {
            credentials: 'include',
            redirect: 'manual',
          });

          if (response.status === 200) {
            log('โ ุตูุญุฉ ุงูููู ุงูุดุฎุตู ูุชุงุญุฉ - ุชู ุญู ูุดููุฉ "ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุงูุฏุฎูู"', 'success');
          } else if (response.status === 302 || response.status === 307) {
            const redirectLocation = response.headers.get('location');
            if (redirectLocation && redirectLocation.includes('/login')) {
              log('โ ูุง ูุฒุงู ููุงู ูุดููุฉ - ูุชู ุงูุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู', 'error');
            } else {
              log(`๐ ุชูุฌูู ุฅูู: ${redirectLocation}`, 'warning');
            }
          }
        } catch (error) {
          log(`โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุตูุญุฉ ุงูููู ุงูุดุฎุตู: ${error.message}`, 'error');
        }
      }

      async function testStoreDashboard() {
        log('๐ช ุงุฎุชุจุงุฑ ููุญุฉ ุชุญูู ุงููุชุฌุฑ...', 'info');

        try {
          const response = await fetch('/store/dashboard', {
            credentials: 'include',
            redirect: 'manual',
          });

          if (response.status === 200) {
            log('โ ููุญุฉ ุชุญูู ุงููุชุฌุฑ ูุชุงุญุฉ - ุชู ุฅุตูุงุญ ูุดุงูู ุงููุตุงุฏูุฉ', 'success');
          } else if (response.status === 302 || response.status === 307) {
            const redirectLocation = response.headers.get('location');
            if (redirectLocation && redirectLocation.includes('/login')) {
              log('โ ูุง ูุฒุงู ููุงู ูุดููุฉ - ูุชู ุงูุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู', 'error');
            } else {
              log(`๐ ุชูุฌูู ุฅูู: ${redirectLocation}`, 'warning');
            }
          }
        } catch (error) {
          log(`โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ููุญุฉ ุชุญูู ุงููุชุฌุฑ: ${error.message}`, 'error');
        }
      }

      async function runFullTest() {
        log('๐ ุจุฏุก ุงูุงุฎุชุจุงุฑ ุงูุดุงูู ูุญู ูุดุงูู ุงููุตุงุฏูุฉ...', 'info');
        log('='.repeat(60), 'info');

        await testLogin();

        // Wait for login to complete
        await new Promise((resolve) => setTimeout(resolve, 2000));
        await testProtectedRoutes();
        await testNewProject();
        await testUserProfile();
        await testStoreDashboard();

        log('='.repeat(60), 'info');
        log('๐ ุงูุชูู ุงูุงุฎุชุจุงุฑ ุงูุดุงูู!', 'info');

        if (window.userLoggedIn) {
          log('๐ ุงููุชูุฌุฉ: ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ', 'success');
          log('๐ ููููู ุงูุขู ุงุฎุชุจุงุฑ ุงูุตูุญุงุช ูุฏููุงู', 'info');
        } else {
          log('๐ ุงููุชูุฌุฉ: ููุงู ูุดุงูู ูู ุชุณุฌูู ุงูุฏุฎูู ุชุญุชุงุฌ ูุญู', 'error');
        }
      }

      // Auto-run check on page load
      window.addEventListener('load', () => {
        log('๐ง ุชู ุชุญููู ุตูุญุฉ ุงุฎุชุจุงุฑ ุฅุตูุงุญ ุงููุตุงุฏูุฉ', 'info');
        log('๐ ุงุณุชุฎุฏู ุงูุฃุฒุฑุงุฑ ุฃุนูุงู ูุงุฎุชุจุงุฑ ุฌูุงูุจ ูุฎุชููุฉ ูู ุงููุธุงู', 'info');
      });
    </script>
  </body>
</html>
