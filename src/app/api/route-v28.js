(()=>{var e={};e.id=2442,e.ids=[2442],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},35707:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>h,serverHooks:()=>g,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{GET:()=>l,POST:()=>d});var n=t(96559),i=t(48088),a=t(37719),o=t(32190),u=t(61223),p=t(44999),c=t(56806);async function d(e){try{let r=(0,p.cookies)(),t=(0,u.createRouteHandlerClient)({cookies:()=>r}),{data:{user:s}}=await t.auth.getUser();if(!s)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{action:n,amount:i,paymentMethod:a,description:d}=await e.json();if("add_funds"===n){let e=await c.Ui.addFunds(s.id,i,a,d);return o.NextResponse.json(e)}if("withdraw_funds"!==n)return o.NextResponse.json({error:"Invalid action"},{status:400});{let e=await c.Ui.withdrawFunds(s.id,i,d);return o.NextResponse.json(e)}}catch(e){return o.NextResponse.json({error:e instanceof Error?e.message:"An error occurred"},{status:500})}}async function l(e){try{let r=(0,p.cookies)(),t=(0,u.createRouteHandlerClient)({cookies:()=>r}),{data:{user:s}}=await t.auth.getUser();if(!s)return o.NextResponse.json({error:"Unauthorized"},{status:401});let n=e.nextUrl.searchParams,i=n.get("action");if("get_balance"===i){let e=await c.Ui.getUserBalance(s.id);return o.NextResponse.json({balance:e})}if("get_transactions"!==i)return o.NextResponse.json({error:"Invalid action"},{status:400});{let e=parseInt(n.get("limit")||"10",10),r=parseInt(n.get("offset")||"0",10),t=await c.Ui.getTransactionHistory(s.id,{limit:e,offset:r});return o.NextResponse.json(t)}}catch(e){return o.NextResponse.json({error:e instanceof Error?e.message:"An error occurred"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/balance/route",pathname:"/api/balance",filename:"route",bundlePath:"app/api/balance/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\balance\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:f,serverHooks:g}=h;function w(){return(0,a.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:f})}},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=51906,e.exports=r},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56806:(e,r,t)=>{"use strict";t.d(r,{Ui:()=>n});let s=(0,t(61223).createClientComponentClient)();class n{async authenticateSupervisor(e,r){try{let{data:t,error:n}=await s.auth.signInWithPassword({email:e,password:r});if(n||!t.user)return null;let{data:i,error:a}=await s.from("supervisors").select("*").eq("user_id",t.user.id).eq("active",!0).single();if(a||!i)return null;let o=this.generateSessionToken(),u=new Date;return u.setHours(u.getHours()+8),await s.from("supervisor_sessions").insert({supervisor_id:i.id,session_token:o,expires_at:u.toISOString()}),this.currentSupervisor=i,this.authToken=o,{supervisor:i,token:o}}catch(e){return null}}async validateSupervisorSession(e){try{let{data:r,error:t}=await s.from("supervisor_sessions").select(`
          *,
          supervisors (*)
        `).eq("session_token",e).gt("expires_at",new Date().toISOString()).single();if(t||!r)return null;return this.currentSupervisor=r.supervisors,this.authToken=e,r.supervisors}catch(e){return null}}async logout(){this.authToken&&await s.from("supervisor_sessions").delete().eq("session_token",this.authToken),this.currentSupervisor=null,this.authToken=null}async requestAuthorization(e){try{let{data:r,error:t}=await s.from("authorization_requests").insert({user_id:e.user_id,action:e.action,resource:e.resource,reason:e.reason,status:"pending",requested_at:new Date().toISOString()}).select().single();if(t)return null;return await this.notifySupervisors(r),r}catch(e){return null}}async getPendingAuthorizations(){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{data:e,error:r}=await s.from("authorization_requests").select(`
          *,
          users (name, email)
        `).eq("status","pending").order("requested_at",{ascending:!1});if(r)return[];return e||[]}catch(e){return[]}}async approveAuthorization(e,r){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{error:t}=await s.from("authorization_requests").update({status:"approved",approved_at:new Date().toISOString(),approved_by:this.currentSupervisor.id,supervisor_reason:r}).eq("id",e);if(t)return!1;return!0}catch(e){return!1}}async denyAuthorization(e,r){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{error:t}=await s.from("authorization_requests").update({status:"denied",approved_at:new Date().toISOString(),approved_by:this.currentSupervisor.id,supervisor_reason:r}).eq("id",e);if(t)return!1;return!0}catch(e){return!1}}hasPermission(e){return!!this.currentSupervisor&&(this.currentSupervisor.permissions.includes(e)||this.currentSupervisor.permissions.includes("*"))}canApprove(e,r){if(!this.currentSupervisor)return!1;let t=`approve:${e}:${r}`,s=`approve:${e}:*`;return this.hasPermission(t)||this.hasPermission(s)||this.hasPermission("approve:*:*")}async approveBalanceAdjustment(e,r,t){try{if(!this.canApprove("balance_adjustment","user_account"))throw Error("Insufficient permissions for balance adjustment");let{error:n}=await s.from("balance_approvals").insert({user_id:e,supervisor_id:this.currentSupervisor.id,amount:r,reason:t,approved_at:new Date().toISOString()});if(n)return!1;let{error:i}=await s.rpc("adjust_user_balance",{user_id:e,amount:r});if(i)return!1;return!0}catch(e){return!1}}generateSessionToken(){return"sup_"+Math.random().toString(36).substr(2,15)+Date.now().toString(36)}async notifySupervisors(e){}getCurrentSupervisor(){return this.currentSupervisor}isAuthenticated(){return null!==this.currentSupervisor&&null!==this.authToken}constructor(){this.currentSupervisor=null,this.authToken=null}}let i=new n},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,580,9398,1223,4999],()=>t(35707));module.exports=s})();