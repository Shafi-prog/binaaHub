(()=>{var e={};e.id=1230,e.ids=[1230],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10663:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>g,routeModule:()=>m,serverHooks:()=>y,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>x});var r={};t.r(r),t.d(r,{DELETE:()=>d,GET:()=>l,POST:()=>p});var o=t(96559),n=t(48088),i=t(37719),a=t(32190),u=t(44999),c=t(61223);async function p(e){try{let{email:s,password:t,remember_me:r=!1}=await e.json();if(!s||!t)return a.NextResponse.json({success:!1,error:"Email and password are required"},{status:400});let o=(0,c.createRouteHandlerClient)({cookies:u.cookies});await new Promise(e=>setTimeout(e,500));let{data:n,error:i}=await o.auth.signInWithPassword({email:s,password:t});if(i||!n.session){if(i?.message?.includes("rate limit")||i?.message?.includes("too many requests")||i?.message?.includes("429"))return a.NextResponse.json({success:!1,error:"تم تجاوز حد المحاولات. يرجى المحاولة بعد دقيقة واحدة."},{status:429});return a.NextResponse.json({success:!1,error:i?.message||"Login failed"},{status:401})}let{data:p,error:l}=await o.from("users").select("*").eq("email",s).order("updated_at",{ascending:!1}).limit(1),d=p?.[0];if(l||!d?.account_type)return a.NextResponse.json({success:!1,error:"Failed to fetch user data"},{status:500});let m="store"===d.account_type?"/store/dashboard":"user"===d.account_type||"client"===d.account_type?"/user/dashboard":"engineer"===d.account_type||"consultant"===d.account_type?"/dashboard/construction-data":"/",_=a.NextResponse.json({success:!0,message:"Sync login successful",user:{id:n.session.user.id,email:n.session.user.email,account_type:d.account_type,name:d.name,phone:d.phone,is_verified:d.is_verified,status:d.status},session:{access_token:n.session.access_token,refresh_token:n.session.refresh_token,expires_at:n.session.expires_at},redirect_to:m,sync_timestamp:new Date().toISOString()}),x={secure:!0,sameSite:"lax",path:"/",maxAge:r?2592e3:86400};return _.cookies.set("auth_session_active","true",{...x,httpOnly:!1}),_.cookies.set("user_email",encodeURIComponent(n.session.user.email||""),{...x,httpOnly:!1}),_.cookies.set("account_type",d.account_type,{...x,httpOnly:!1}),_.cookies.set("user_name",encodeURIComponent(d.name||""),{...x,httpOnly:!1}),_.cookies.set("sync_login_timestamp",new Date().toISOString(),{...x,httpOnly:!1}),r&&_.cookies.set("remember_user","true",{...x,maxAge:2592e3,httpOnly:!1}),_}catch(e){return a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function l(e){try{let e=(0,c.createRouteHandlerClient)({cookies:u.cookies}),{data:{session:s},error:t}=await e.auth.getSession();if(t||!s)return a.NextResponse.json({success:!1,error:"No active sync login session"},{status:401});let{data:r,error:o}=await e.from("users").select("*").eq("id",s.user.id).order("updated_at",{ascending:!1}).limit(1),n=r?.[0];if(o||!n)return a.NextResponse.json({success:!1,error:"Failed to validate sync login"},{status:500});let i=await (0,u.cookies)(),p=i.get("sync_login_timestamp")?.value;return a.NextResponse.json({success:!0,sync_login_active:!0,user:{id:s.user.id,email:s.user.email,account_type:n.account_type,name:n.name,is_verified:n.is_verified,status:n.status},session:{expires_at:s.expires_at},sync_timestamp:p||new Date().toISOString()})}catch(e){return a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function d(e){try{let e=(0,c.createRouteHandlerClient)({cookies:u.cookies});await e.auth.signOut();let s=a.NextResponse.json({success:!0,message:"Sync login session cleared successfully"}),t={secure:!0,sameSite:"lax",path:"/",maxAge:0};return s.cookies.set("auth_session_active","",t),s.cookies.set("user_email","",t),s.cookies.set("account_type","",t),s.cookies.set("user_name","",t),s.cookies.set("sync_login_timestamp","",t),s.cookies.set("remember_user","",t),s}catch(e){return a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/sync-login/route",pathname:"/api/auth/sync-login",filename:"route",bundlePath:"app/api/auth/sync-login/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\auth\\sync-login\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:_,workUnitAsyncStorage:x,serverHooks:y}=m;function g(){return(0,i.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function s(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}s.keys=()=>[],s.resolve=s,s.id=51906,e.exports=s},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4243,580,9398,1223,4999],()=>t(10663));module.exports=r})();