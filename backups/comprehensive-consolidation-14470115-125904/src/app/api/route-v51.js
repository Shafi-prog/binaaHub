(()=>{var e={};e.id=1041,e.ids=[1041],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30660:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>x,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{GET:()=>p});var o=t(96559),i=t(48088),n=t(37719),a=t(32190),u=t(61223),l=t(44999),c=t(94929);async function p(e){try{let e=(0,l.cookies)(),s=(0,u.createRouteHandlerClient)({cookies:()=>e}),{data:{user:t}}=await s.auth.getUser();if(!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=await c.Sm.getImportSessions(t.id);return a.NextResponse.json({sessions:r})}catch(e){return a.NextResponse.json({error:e instanceof Error?e.message:"An error occurred"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/excel-import/sessions/route",pathname:"/api/excel-import/sessions",filename:"route",bundlePath:"app/api/excel-import/sessions/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\excel-import\\sessions\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:m,workUnitAsyncStorage:h,serverHooks:g}=d;function x(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:h})}},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function s(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}s.keys=()=>[],s.resolve=s,s.id=51906,e.exports=s},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},94929:(e,s,t)=>{"use strict";t.d(s,{Sm:()=>r});class r{async createSession(e,s){let t=this.generateSessionId(),r={id:t,filename:e,totalRows:s,processedRows:0,status:"pending",createdAt:new Date,errors:[]};return this.sessions.set(t,r),t}async getSession(e){return this.sessions.get(e)||null}async getAllSessions(){return Array.from(this.sessions.values()).sort((e,s)=>s.createdAt.getTime()-e.createdAt.getTime())}async searchSessions(e){let s=(await this.getAllSessions()).filter(s=>s.filename.toLowerCase().includes(e.toLowerCase())||s.id.includes(e)||s.status.includes(e));return{sessions:s,total:s.length}}async deleteSession(e){return this.sessions.delete(e)}async processExcelFile(e,s){let t=this.sessions.get(s);if(!t)throw Error("Session not found");t.status="processing",this.sessions.set(s,t);try{let s=await this.parseExcelFile(e);await this.processData(s,t),t.status="completed",t.completedAt=new Date}catch(e){t.status="failed",t.errors.push({row:-1,column:"general",message:e instanceof Error?e.message:"Unknown error occurred"})}return this.sessions.set(s,t),t}async parseExcelFile(e){let s=(await e.text()).split("\n"),t=s[0]?.split(",")||[],r=[];for(let e=1;e<s.length;e++)if(s[e].trim()){let o=s[e].split(","),i={};t.forEach((e,s)=>{i[e.trim()]=o[s]?.trim()||""}),r.push(i)}return r}async processData(e,s){for(let t=0;t<e.length;t++){let r=e[t],o=t+2;try{await this.processRow(r,o,s),s.processedRows++}catch(e){s.errors.push({row:o,column:"general",message:e instanceof Error?e.message:"Failed to process row"})}this.sessions.set(s.id,{...s})}}async processRow(e,s,t){let r=this.validateRow(e,s);if(r.length>0)return void t.errors.push(...r);await new Promise(e=>setTimeout(e,10))}validateRow(e,s){let t=[];return e.name&&""!==e.name.trim()||t.push({row:s,column:"name",message:"Name is required",value:e.name}),e.email&&!this.isValidEmail(e.email)&&t.push({row:s,column:"email",message:"Invalid email format",value:e.email}),e.phone&&!this.isValidPhone(e.phone)&&t.push({row:s,column:"phone",message:"Invalid phone format",value:e.phone}),t}async getImportTemplates(){return["customers","products","orders","inventory","suppliers","employees"]}async generateTemplate(e){return({customers:"name,email,phone,company,address\nJohn Doe,john@example.com,+1234567890,Acme Corp,123 Main St",products:"sku,name,category,price,stock\nPROD001,Widget,Electronics,29.99,100",orders:"order_id,customer_email,product_sku,quantity,date\nORD001,john@example.com,PROD001,2,2024-02-15",inventory:"sku,current_stock,minimum_stock,location\nPROD001,100,10,Warehouse A",suppliers:"name,email,phone,products\nSupplier Inc,supplier@example.com,+1987654321,Electronics",employees:"name,email,department,position,salary\nJane Smith,jane@example.com,IT,Developer,75000"})[e]||"Invalid template type"}generateSessionId(){return"session_"+Date.now().toString(36)+Math.random().toString(36).substr(2)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPhone(e){return/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[-\s\(\)]/g,""))}async getImportStats(){let e=await this.getAllSessions();return{totalSessions:e.length,completedSessions:e.filter(e=>"completed"===e.status).length,failedSessions:e.filter(e=>"failed"===e.status).length,totalRowsProcessed:e.reduce((e,s)=>e+s.processedRows,0)}}constructor(){this.sessions=new Map}}new r},96487:()=>{}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4243,580,9398,1223,4999],()=>t(30660));module.exports=r})();