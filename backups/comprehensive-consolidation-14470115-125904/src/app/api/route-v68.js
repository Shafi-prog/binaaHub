(()=>{var e={};e.id=3071,e.ids=[3071],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9420:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>h,serverHooks:()=>x,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{GET:()=>l,POST:()=>d});var i=t(96559),n=t(48088),o=t(37719),a=t(32190),u=t(44999),p=t(61223),c=t(56806);async function d(e){try{let r=(0,p.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:t},error:s}=await r.auth.getUser();if(s||!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{action:i,...n}=await e.json();switch(i){case"register_supervisor":let{profile:o}=n,d=await c.Ui.registerSupervisor(t.id,o);return a.NextResponse.json(d);case"request_supervisor":let{requirements:l}=n,h=await c.Ui.requestSupervisor(t.id,l);return a.NextResponse.json(h);case"respond_to_request":let{requestId:v,response:w,responseMessage:x}=n,_=await c.Ui.respondToRequest(t.id,v,w,x);return a.NextResponse.json(_);case"create_contract":let{contractData:m}=n,f=await c.Ui.createContract(t.id,m);return a.NextResponse.json(f);case"sign_contract":let{contractId:S,signatureType:g}=n,y=await c.Ui.signContract(S,t.id,g);return a.NextResponse.json(y);case"record_expense":let{expenseData:q}=n,j=await c.Ui.recordExpense(q);return a.NextResponse.json(j);case"complete_milestone":let{milestoneId:R,completionNotes:U}=n,N=await c.Ui.completeMilestone(R,t.id,U);return a.NextResponse.json(N);case"approve_expense":let{expenseId:k,status:T,notes:b}=n,A=await c.Ui.approveExpense(k,t.id,T,b);return a.NextResponse.json(A);case"add_funds":let{amount:z,paymentMethod:C,description:I}=n,P=await c.Ui.addFunds(t.id,z,C,I);return a.NextResponse.json(P);case"withdraw_funds":let{withdrawAmount:O,withdrawDescription:E}=n,D=await c.Ui.withdrawFunds(t.id,O,E);return a.NextResponse.json(D);case"request_authorization":let{projectId:F,authAmount:H,purpose:M,authType:W,category:$,expiryDate:B,authNotes:L}=n,G=await c.Ui.requestSpendingAuthorization(t.id,n.userId,F,H,M,W,$,B,L);return a.NextResponse.json(G);case"respond_authorization":let{authorizationId:K,authResponse:X,responseNotes:J}=n,Q=await c.Ui.respondToAuthorizationRequest(t.id,K,X,J);return a.NextResponse.json(Q);case"record_commission":let{commissionData:V}=n,Y=await c.Ui.recordCommission(V.supervisorId,t.id,V.projectId,V.commissionType,V.baseAmount,V.percentage,V.description,{referenceId:V.referenceId,referenceType:V.referenceType});return a.NextResponse.json(Y);case"pay_commission":let{commissionId:Z}=n,ee=await c.Ui.payCommission(Z,t.id);return a.NextResponse.json(ee);case"record_warranty":let{projectId:er,itemData:et}=n,es=await c.Ui.recordWarranty(er,t.id,et);return a.NextResponse.json(es);case"update_warranty":let{warrantyId:ei,warrantyStatus:en,claimDetails:eo}=n,ea=await c.Ui.updateWarrantyStatus(ei,en,eo);return a.NextResponse.json(ea);default:return a.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return a.NextResponse.json({error:e instanceof Error?e.message:"Failed to process supervisor action"},{status:500})}}async function l(e){try{let r,t=(0,p.createRouteHandlerClient)({cookies:u.cookies}),{searchParams:s}=new URL(e.url),i="1"===s.get("public"),n=s.get("email")||void 0,o=s.get("city")||void 0;if(i)return r=await c.Ui.getAvailableSupervisors({isPublic:!0,email:n,city:o}),a.NextResponse.json({supervisors:r});let{data:{user:d},error:l}=await t.auth.getUser();if(l||!d)return a.NextResponse.json({error:"Unauthorized"},{status:401});return r=await c.Ui.getAvailableSupervisors({email:n,city:o}),a.NextResponse.json({supervisors:r})}catch(e){return a.NextResponse.json({error:"Failed to fetch supervisor data"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/supervisors/route",pathname:"/api/supervisors",filename:"route",bundlePath:"app/api/supervisors/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\supervisors\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:w,serverHooks:x}=h;function _(){return(0,o.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:w})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=51906,e.exports=r},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56806:(e,r,t)=>{"use strict";t.d(r,{Ui:()=>i});let s=(0,t(61223).createClientComponentClient)();class i{async authenticateSupervisor(e,r){try{let{data:t,error:i}=await s.auth.signInWithPassword({email:e,password:r});if(i||!t.user)return null;let{data:n,error:o}=await s.from("supervisors").select("*").eq("user_id",t.user.id).eq("active",!0).single();if(o||!n)return null;let a=this.generateSessionToken(),u=new Date;return u.setHours(u.getHours()+8),await s.from("supervisor_sessions").insert({supervisor_id:n.id,session_token:a,expires_at:u.toISOString()}),this.currentSupervisor=n,this.authToken=a,{supervisor:n,token:a}}catch(e){return null}}async validateSupervisorSession(e){try{let{data:r,error:t}=await s.from("supervisor_sessions").select(`
          *,
          supervisors (*)
        `).eq("session_token",e).gt("expires_at",new Date().toISOString()).single();if(t||!r)return null;return this.currentSupervisor=r.supervisors,this.authToken=e,r.supervisors}catch(e){return null}}async logout(){this.authToken&&await s.from("supervisor_sessions").delete().eq("session_token",this.authToken),this.currentSupervisor=null,this.authToken=null}async requestAuthorization(e){try{let{data:r,error:t}=await s.from("authorization_requests").insert({user_id:e.user_id,action:e.action,resource:e.resource,reason:e.reason,status:"pending",requested_at:new Date().toISOString()}).select().single();if(t)return null;return await this.notifySupervisors(r),r}catch(e){return null}}async getPendingAuthorizations(){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{data:e,error:r}=await s.from("authorization_requests").select(`
          *,
          users (name, email)
        `).eq("status","pending").order("requested_at",{ascending:!1});if(r)return[];return e||[]}catch(e){return[]}}async approveAuthorization(e,r){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{error:t}=await s.from("authorization_requests").update({status:"approved",approved_at:new Date().toISOString(),approved_by:this.currentSupervisor.id,supervisor_reason:r}).eq("id",e);if(t)return!1;return!0}catch(e){return!1}}async denyAuthorization(e,r){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{error:t}=await s.from("authorization_requests").update({status:"denied",approved_at:new Date().toISOString(),approved_by:this.currentSupervisor.id,supervisor_reason:r}).eq("id",e);if(t)return!1;return!0}catch(e){return!1}}hasPermission(e){return!!this.currentSupervisor&&(this.currentSupervisor.permissions.includes(e)||this.currentSupervisor.permissions.includes("*"))}canApprove(e,r){if(!this.currentSupervisor)return!1;let t=`approve:${e}:${r}`,s=`approve:${e}:*`;return this.hasPermission(t)||this.hasPermission(s)||this.hasPermission("approve:*:*")}async approveBalanceAdjustment(e,r,t){try{if(!this.canApprove("balance_adjustment","user_account"))throw Error("Insufficient permissions for balance adjustment");let{error:i}=await s.from("balance_approvals").insert({user_id:e,supervisor_id:this.currentSupervisor.id,amount:r,reason:t,approved_at:new Date().toISOString()});if(i)return!1;let{error:n}=await s.rpc("adjust_user_balance",{user_id:e,amount:r});if(n)return!1;return!0}catch(e){return!1}}generateSessionToken(){return"sup_"+Math.random().toString(36).substr(2,15)+Date.now().toString(36)}async notifySupervisors(e){}getCurrentSupervisor(){return this.currentSupervisor}isAuthenticated(){return null!==this.currentSupervisor&&null!==this.authToken}constructor(){this.currentSupervisor=null,this.authToken=null}}let n=new i},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,580,9398,1223,4999],()=>t(9420));module.exports=s})();