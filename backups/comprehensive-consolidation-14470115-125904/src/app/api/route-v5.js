(()=>{var e={};e.id=2559,e.ids=[2559],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4100:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>P,routeModule:()=>y,serverHooks:()=>w,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>m});var a=r(96559),n=r(48088),o=r(37719),i=r(32190),u=r(79748),c=r(33873),p=r(29021);async function d(e,t){await new Promise(e=>setTimeout(e,3e3));let r=[{progressPercentage:75.5,qualityScore:.87,detectedElements:["أساسات خرسانية","هيكل حديدي","جدران خارجية","سقف الدور الأول","نوافذ جانبية"],recommendations:["التقدم ممتاز، حافظ على الوتيرة الحالية","فحص جودة الخرسانة في الأساسات","التأكد من استقامة الجدران الخارجية","التحضير لمرحلة التشطيبات الداخلية"],progressChange:12.3,areasChanged:["الجدران الشرقية","السقف الخرساني"]},{progressPercentage:45.2,qualityScore:.92,detectedElements:["حفر الأساسات","قواعد خرسانية","حديد تسليح","صب خرساني جزئي"],recommendations:["تقدم جيد في مرحلة الأساسات","ضرورة إنهاء صب الخرسانة خلال يومين","فحص مستوى القواعد الخرسانية","التحضير لمرحلة البناء الفوقي"],progressChange:8.7,areasChanged:["منطقة الأساسات الشمالية"]},{progressPercentage:90.8,qualityScore:.95,detectedElements:["بناء مكتمل","تشطيبات خارجية","نوافذ وأبواب","سقف نهائي","أعمال كهربائية"],recommendations:["المشروع قارب على الاكتمال","التركيز على التشطيبات النهائية","فحص الأعمال الكهربائية والصحية","إعداد المشروع للتسليم النهائي"],progressChange:5.2,areasChanged:["التشطيبات الداخلية","الواجهة الأمامية"]}];return r[Math.floor(Math.random()*r.length)]}async function g(e){let t=process.env.OPENAI_API_KEY;if(!t)throw Error("OpenAI API key not configured");let r=e.toString("base64"),s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o",messages:[{role:"system",content:`أنت خبير في تحليل صور مواقع البناء والتشييد. حلل الصورة وقدم تقريرًا بتنسيق JSON يحتوي على:
          {
            "progressPercentage": نسبة التقدم من 0 إلى 100,
            "qualityScore": تقييم الجودة من 0 إلى 1,
            "detectedElements": ["قائمة بالعناصر المكتشفة في الصورة"],
            "recommendations": ["توصيات لتحسين العمل"],
            "constructionPhase": "مرحلة البناء الحالية",
            "safetyIssues": ["مشاكل السلامة إن وجدت"]
          }`},{role:"user",content:[{type:"text",text:"حلل هذه الصورة لموقع البناء وقدم تقريرًا مفصلاً عن التقدم والجودة"},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${r}`}}]}],temperature:.1})});if(!s.ok)throw Error("Failed to analyze with OpenAI Vision");return JSON.parse((await s.json()).choices[0].message.content)}async function l(e,t){return{progressChange:20*Math.random(),areasChanged:["منطقة الأساسات","الجدران الخارجية"],similarityScore:.75+.2*Math.random()}}async function m(e){try{let t,r=await e.formData(),s=r.get("image"),a=r.get("userId"),n=r.get("projectId"),o=r.get("timestamp"),m=r.get("latitude"),y=r.get("longitude");if(!s)return i.NextResponse.json({error:"لم يتم تحديد صورة"},{status:400});if(!n)return i.NextResponse.json({error:"يجب تحديد المشروع"},{status:400});let f=(0,c.join)(process.cwd(),"uploads","construction-progress");(0,p.existsSync)(f)||await (0,u.mkdir)(f,{recursive:!0});let x=await s.arrayBuffer(),w=Buffer.from(x),P=`${n}-${a}-${Date.now()}-${s.name}`,C=(0,c.join)(f,P);await (0,u.writeFile)(C,w),t=process.env.OPENAI_API_KEY?await g(w):await d(w,P);let j=await l(w,n);return t.progressChange=j.progressChange,t.areasChanged=j.areasChanged,await h(a,n,P,t,{latitude:m?parseFloat(m):null,longitude:y?parseFloat(y):null,timestamp:o}),i.NextResponse.json({success:!0,analysis:t,fileName:P,location:{latitude:m,longitude:y},message:"تم تحليل التقدم بنجاح"})}catch(e){return i.NextResponse.json({error:"فشل في تحليل صورة التقدم"},{status:500})}}async function h(e,t,r,s,a){}let y=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/ai/analyze-construction-progress/route",pathname:"/api/ai/analyze-construction-progress",filename:"route",bundlePath:"app/api/ai/analyze-construction-progress/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\ai\\analyze-construction-progress\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:x,serverHooks:w}=y;function P(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79748:e=>{"use strict";e.exports=require("fs/promises")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580],()=>r(4100));module.exports=s})();