(()=>{var e={};e.id=8108,e.ids=[8108],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=51906,e.exports=r},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56806:(e,r,t)=>{"use strict";t.d(r,{Ui:()=>i});let s=(0,t(61223).createClientComponentClient)();class i{async authenticateSupervisor(e,r){try{let{data:t,error:i}=await s.auth.signInWithPassword({email:e,password:r});if(i||!t.user)return null;let{data:o,error:n}=await s.from("supervisors").select("*").eq("user_id",t.user.id).eq("active",!0).single();if(n||!o)return null;let a=this.generateSessionToken(),u=new Date;return u.setHours(u.getHours()+8),await s.from("supervisor_sessions").insert({supervisor_id:o.id,session_token:a,expires_at:u.toISOString()}),this.currentSupervisor=o,this.authToken=a,{supervisor:o,token:a}}catch(e){return null}}async validateSupervisorSession(e){try{let{data:r,error:t}=await s.from("supervisor_sessions").select(`
          *,
          supervisors (*)
        `).eq("session_token",e).gt("expires_at",new Date().toISOString()).single();if(t||!r)return null;return this.currentSupervisor=r.supervisors,this.authToken=e,r.supervisors}catch(e){return null}}async logout(){this.authToken&&await s.from("supervisor_sessions").delete().eq("session_token",this.authToken),this.currentSupervisor=null,this.authToken=null}async requestAuthorization(e){try{let{data:r,error:t}=await s.from("authorization_requests").insert({user_id:e.user_id,action:e.action,resource:e.resource,reason:e.reason,status:"pending",requested_at:new Date().toISOString()}).select().single();if(t)return null;return await this.notifySupervisors(r),r}catch(e){return null}}async getPendingAuthorizations(){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{data:e,error:r}=await s.from("authorization_requests").select(`
          *,
          users (name, email)
        `).eq("status","pending").order("requested_at",{ascending:!1});if(r)return[];return e||[]}catch(e){return[]}}async approveAuthorization(e,r){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{error:t}=await s.from("authorization_requests").update({status:"approved",approved_at:new Date().toISOString(),approved_by:this.currentSupervisor.id,supervisor_reason:r}).eq("id",e);if(t)return!1;return!0}catch(e){return!1}}async denyAuthorization(e,r){try{if(!this.currentSupervisor)throw Error("Not authenticated as supervisor");let{error:t}=await s.from("authorization_requests").update({status:"denied",approved_at:new Date().toISOString(),approved_by:this.currentSupervisor.id,supervisor_reason:r}).eq("id",e);if(t)return!1;return!0}catch(e){return!1}}hasPermission(e){return!!this.currentSupervisor&&(this.currentSupervisor.permissions.includes(e)||this.currentSupervisor.permissions.includes("*"))}canApprove(e,r){if(!this.currentSupervisor)return!1;let t=`approve:${e}:${r}`,s=`approve:${e}:*`;return this.hasPermission(t)||this.hasPermission(s)||this.hasPermission("approve:*:*")}async approveBalanceAdjustment(e,r,t){try{if(!this.canApprove("balance_adjustment","user_account"))throw Error("Insufficient permissions for balance adjustment");let{error:i}=await s.from("balance_approvals").insert({user_id:e,supervisor_id:this.currentSupervisor.id,amount:r,reason:t,approved_at:new Date().toISOString()});if(i)return!1;let{error:o}=await s.rpc("adjust_user_balance",{user_id:e,amount:r});if(o)return!1;return!0}catch(e){return!1}}generateSessionToken(){return"sup_"+Math.random().toString(36).substr(2,15)+Date.now().toString(36)}async notifySupervisors(e){}getCurrentSupervisor(){return this.currentSupervisor}isAuthenticated(){return null!==this.currentSupervisor&&null!==this.authToken}constructor(){this.currentSupervisor=null,this.authToken=null}}let o=new i},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65968:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>h,serverHooks:()=>f,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>l});var i=t(96559),o=t(48088),n=t(37719),a=t(32190),u=t(44999),p=t(61223),c=t(56806);async function d(e){try{let r=(0,p.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:t},error:s}=await r.auth.getUser();if(s||!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let i=e.nextUrl.searchParams,o=i.get("supervisorId");i.get("userId"),i.get("projectId"),i.get("status"),i.get("limit")&&parseInt(i.get("limit")||"10"),i.get("offset")&&parseInt(i.get("offset")||"0");let n=await c.Ui.getSupervisorCommissions(o||t.id);return a.NextResponse.json(n)}catch(e){return a.NextResponse.json({error:e instanceof Error?e.message:"Failed to fetch commissions"},{status:500})}}async function l(e){try{let r=(0,p.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:t},error:s}=await r.auth.getUser();if(s||!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{action:i,...o}=await e.json();switch(i){case"record_commission":{let{userId:e,projectId:r,commissionType:s,baseAmount:i,percentage:n,description:u,expenseId:p,purchaseId:d}=o,l=await c.Ui.recordCommission(t.id,e,r,s,i,n,u,{expenseId:p,purchaseId:d});return a.NextResponse.json(l)}case"pay_commission":{let{commissionId:e,paymentMethod:r}=o,t=await c.Ui.payCommission(e,r);return a.NextResponse.json(t)}default:return a.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return a.NextResponse.json({error:e instanceof Error?e.message:"Failed to process commission action"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/commissions/route",pathname:"/api/commissions",filename:"route",bundlePath:"app/api/commissions/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\commissions\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:m,serverHooks:f}=h;function g(){return(0,n.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:m})}},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,580,9398,1223,4999],()=>t(65968));module.exports=s})();