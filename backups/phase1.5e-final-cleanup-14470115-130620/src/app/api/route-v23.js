(()=>{var e={};e.id=8887,e.ids=[8887],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},12182:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>q,routeModule:()=>w,serverHooks:()=>x,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>y});var a=r(96559),i=r(48088),o=r(37719),u=r(32190),n=r(44999),c=r(61223),d=r(39398);let p=(0,c.createClientComponentClient)();class l{constructor(){this.baseUrl="http://localhost:9000",this.apiKey=process.env.MEDUSA_API_KEY}async makeRequest(e,t={}){let r=`${this.baseUrl}${e}`,s={"Content-Type":"application/json",...this.apiKey&&{Authorization:`Bearer ${this.apiKey}`},...t.headers};try{let e=await fetch(r,{...t,headers:s});if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw e}}async getProducts(e=50,t=0){try{return await this.makeRequest(`/store/products?limit=${e}&offset=${t}`)}catch(e){return{products:[],count:0}}}async getProduct(e){try{return(await this.makeRequest(`/store/products/${e}`)).product}catch(e){return null}}async searchProducts(e){try{return(await this.makeRequest(`/store/products?q=${encodeURIComponent(e)}`)).products||[]}catch(e){return[]}}async createCart(){try{return await this.makeRequest("/store/carts",{method:"POST"})}catch(e){return null}}async addToCart(e,t,r){try{return await this.makeRequest(`/store/carts/${e}/line-items`,{method:"POST",body:JSON.stringify({variant_id:t,quantity:r})})}catch(e){throw e}}async updateCartItem(e,t,r){try{return await this.makeRequest(`/store/carts/${e}/line-items/${t}`,{method:"POST",body:JSON.stringify({quantity:r})})}catch(e){throw e}}async removeFromCart(e,t){try{return await this.makeRequest(`/store/carts/${e}/line-items/${t}`,{method:"DELETE"})}catch(e){throw e}}async createCustomer(e){try{return(await this.makeRequest("/store/customers",{method:"POST",body:JSON.stringify(e)})).customer}catch(e){return null}}async authenticateCustomer(e,t){try{return await this.makeRequest("/store/auth",{method:"POST",body:JSON.stringify({email:e,password:t})})}catch(e){return null}}async getOrders(e){try{return(await this.makeRequest(e?"/store/customers/me/orders":"/admin/orders")).orders||[]}catch(e){return[]}}async getOrder(e){try{return(await this.makeRequest(`/store/orders/${e}`)).order}catch(e){return null}}async syncProductsToSupabase(){try{let{products:e}=await this.getProducts(100),t=e.map(e=>({medusa_id:e.id,title:e.title,description:e.description,price:e.price,images:e.images,status:e.status,created_at:e.created_at,updated_at:e.updated_at})),{error:r}=await p.from("products").upsert(t,{onConflict:"medusa_id"});if(r)return!1;return!0}catch(e){return!1}}async syncOrdersToSupabase(e){try{let t=(await this.getOrders(e)).map(e=>({medusa_id:e.id,email:e.email,status:e.status,total:e.total,customer_id:e.customer_id,created_at:e.created_at})),{error:r}=await p.from("orders").upsert(t,{onConflict:"medusa_id"});if(r)return!1;return!0}catch(e){return!1}}}let m=new l,h=async e=>{try{return await m.createCustomer({email:e.email,password:e.password||"temp_password_"+Math.random().toString(36).slice(-8),first_name:e.name.split(" ")[0]||e.name,last_name:e.name.split(" ").slice(1).join(" ")||"",phone:""})}catch(e){return null}};async function y(e){try{let{name:t,email:r,password:s,accountType:a}=await e.json();if(!t||!r||!s)return u.NextResponse.json({success:!1,error:"Name, email, and password are required"},{status:400});if(s.length<6)return u.NextResponse.json({success:!1,error:"Password must be at least 6 characters long"},{status:400});let i=a||"user";if(!["user","store"].includes(i))return u.NextResponse.json({success:!1,error:"Invalid account type. Please select either User or Store."},{status:400});let o=(0,c.createRouteHandlerClient)({cookies:n.cookies}),p=(0,d.createClient)("https://lqhopwohuddhapkhhikf.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:l}=await p.from("users").select("email").eq("email",r).single();if(l)return u.NextResponse.json({success:!1,error:"User with this email already exists"},{status:409});let{data:m,error:y}=await o.auth.signUp({email:r,password:s,options:{data:{name:t}}});if(y){let e=y.message;return y.message.includes("User already registered")?e="يوجد حساب مسجل بالفعل بهذا البريد الإلكتروني":y.message.includes("Invalid email")?e="البريد الإلكتروني غير صحيح":y.message.includes("Password")&&(e="كلمة المرور ضعيفة جداً. يجب أن تكون 6 أحرف على الأقل"),u.NextResponse.json({success:!1,error:e},{status:400})}if(!m.user)return u.NextResponse.json({success:!1,error:"Failed to create user account"},{status:500});let w="BinnaHub-"+Math.random().toString(36).substring(2,10),f={id:m.user.id,email:r,name:t,account_type:i,is_verified:!1,status:"active",invitation_code:w},{error:g}=await p.from("users").insert([f]);if(g)return u.NextResponse.json({success:!1,error:"Failed to complete user registration"},{status:500});try{await h({id:m.user.id,email:r,name:t,account_type:i})}catch(e){}if(!m.session)return u.NextResponse.json({success:!0,message:"Account created! Please check your email to verify your account.",requiresVerification:!0});return u.NextResponse.json({success:!0,message:"Account created successfully!",redirectTo:"store"===i?"/store/dashboard":"/user/dashboard",user:{email:m.user.email,account_type:i}})}catch(e){return u.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\auth\\signup\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:x}=w;function q(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,9398,1223,4999],()=>r(12182));module.exports=s})();