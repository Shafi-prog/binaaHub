<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููุดุฑูุน</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .test-pass { border-left: 4px solid #4CAF50; background: #f8fff8; }
        .test-fail { border-left: 4px solid #f44336; background: #fff8f8; }
        .test-warning { border-left: 4px solid #ff9800; background: #fff8f0; }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover { background: #1976D2; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .log { max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>๐งช ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููุดุฑูุน</h1>
        <p>ูุฐุง ุงูุงุฎุชุจุงุฑ ุณูุชุญูู ูู ุนูู ูุธุงู ุฅูุดุงุก ุงููุดุงุฑูุน</p>

        <div class="test-section test-pass">
            <h3>โ ุงุฎุชุจุงุฑ 1: ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ</h3>
            <p>ุฅุนุฏุงุฏ ุจูุงูุงุช ุงููุดุฑูุน ููุงุฎุชุจุงุฑ</p>
            <button onclick="showTestData()">ุนุฑุถ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ</button>
            <div id="testDataResult"></div>
        </div>

        <div class="test-section test-warning">
            <h3>โ๏ธ ุงุฎุชุจุงุฑ 2: ูุญุต ุงูุงุชุตุงู</h3>
            <p>ูุญุต ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููุตุงุฏูุฉ</p>
            <button onclick="testConnection()">ูุญุต ุงูุงุชุตุงู</button>
            <div id="connectionResult"></div>
        </div>

        <div class="test-section test-warning">
            <h3>๐๏ธ ุงุฎุชุจุงุฑ 3: ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช</h3>
            <p>ูุญุต ุฌุฏูู ุงููุดุงุฑูุน ูุงูุฃุนูุฏุฉ ุงููุทููุจุฉ</p>
            <button onclick="testDatabaseSchema()">ูุญุต ุงููุงุนุฏุฉ</button>
            <div id="schemaResult"></div>
        </div>

        <div class="test-section test-warning">
            <h3>๐ ุงุฎุชุจุงุฑ 4: ุฅูุดุงุก ูุดุฑูุน ุชุฌุฑูุจู</h3>
            <p>ุฅูุดุงุก ูุดุฑูุน ุชุฌุฑูุจู ููุชุฃูุฏ ูู ุนูู ุงููุธุงู</p>
            <button onclick="testProjectCreation()">ุฅูุดุงุก ูุดุฑูุน ุชุฌุฑูุจู</button>
            <div id="createResult"></div>
        </div>

        <div class="test-section">
            <h3>๐ ุงุฎุชุจุงุฑ 5: ุงุฎุชุจุงุฑ ุงููููุฐุฌ</h3>
            <p>ุงุฎุชุจุงุฑ ูููุฐุฌ ุฅูุดุงุก ุงููุดุฑูุน ูุจุงุดุฑุฉ</p>
            <button onclick="openProjectForm()">ูุชุญ ูููุฐุฌ ุงููุดุฑูุน</button>
            <button onclick="fillFormWithTestData()">ููุก ุงููููุฐุฌ ุจุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ</button>
        </div>

        <div class="test-section">
            <h3>๐ ุณุฌู ุงูุงุฎุชุจุงุฑุงุช</h3>
            <div id="testLog" class="log"></div>
            <button onclick="clearLog()">ูุณุญ ุงูุณุฌู</button>
            <button onclick="runAllTests()">ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช</button>
        </div>
    </div>

    <script>
        // Test data
        const testProjectData = {
            name: "ูุดุฑูุน ุงุฎุชุจุงุฑ - " + new Date().toLocaleString('ar'),
            description: "ูุดุฑูุน ุชุฌุฑูุจู ููุชุฃูุฏ ูู ุนูู ุงููุธุงู",
            project_type: "residential",
            status: "planning",
            budget: "150000",
            start_date: "2025-07-15",
            end_date: "2025-11-30",
            city: "ุงูุฑูุงุถ",
            region: "ููุทูุฉ ุงูุฑูุงุถ",
            district: "ุงูุนููุง",
            country: "SA",
            lat: 24.7136,
            lng: 46.6753,
            priority: "medium",
            is_active: true
        };

        function log(message) {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString('ar');
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        function showTestData() {
            const result = document.getElementById('testDataResult');
            result.innerHTML = `
                <div class="status success">
                    <strong>ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ:</strong>
                    <pre>${JSON.stringify(testProjectData, null, 2)}</pre>
                </div>
            `;
            log("โ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ุฌุงูุฒุฉ");
        }

        async function testConnection() {
            const result = document.getElementById('connectionResult');
            log("๐ ูุญุต ุงูุงุชุตุงู...");
            
            try {
                // Check if we can access the current page (basic connectivity)
                const response = await fetch(window.location.origin + '/user/projects/new');
                if (response.ok) {
                    result.innerHTML = `
                        <div class="status success">
                            โ ุงูุงุชุตุงู ุจุงููููุน ูุนูู ุจุดูู ุตุญูุญ
                        </div>
                    `;
                    log("โ ุงูุงุชุตุงู ุจุงููููุน ูุนูู");
                } else {
                    throw new Error('ูุดู ูู ุงูุงุชุตุงู');
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="status error">
                        โ ุฎุทุฃ ูู ุงูุงุชุตุงู: ${error.message}
                    </div>
                `;
                log("โ ุฎุทุฃ ูู ุงูุงุชุตุงู: " + error.message);
            }
        }

        async function testDatabaseSchema() {
            const result = document.getElementById('schemaResult');
            log("๐๏ธ ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช...");
            
            // This is a simulation since we can't directly access Supabase from client-side
            const requiredFields = [
                'name', 'description', 'project_type', 'status', 'budget',
                'start_date', 'end_date', 'location_lat', 'location_lng'
            ];
            
            const enhancedFields = [
                'city', 'region', 'district', 'country', 'priority', 'is_active', 'image_url'
            ];
            
            result.innerHTML = `
                <div class="status warning">
                    <strong>ูุญุต ุงูุฌุฏูู:</strong><br>
                    โ ุงูุญููู ุงูุฃุณุงุณูุฉ: ${requiredFields.join(', ')}<br>
                    โ๏ธ ุงูุญููู ุงููุญุณูุฉ: ${enhancedFields.join(', ')}<br>
                    ๐ก ุฅุฐุง ูู ูุชู ุชุทุจูู Migrationุ ุณุชุญุชุงุฌ ูุชุดุบูู URGENT_DATABASE_FIX.sql
                </div>
            `;
            log("๐๏ธ ูุญุต ุงููุงุนุฏุฉ ููุชูู");
        }

        async function testProjectCreation() {
            const result = document.getElementById('createResult');
            log("๐ ุงุฎุชุจุงุฑ ุฅูุดุงุก ูุดุฑูุน...");
            
            try {
                // Simulate project creation by testing the form fields
                const formData = new FormData();
                Object.keys(testProjectData).forEach(key => {
                    formData.append(key, testProjectData[key]);
                });
                
                result.innerHTML = `
                    <div class="status success">
                        โ ุจูุงูุงุช ุงููุดุฑูุน ุฌุงูุฒุฉ ููุฅุฑุณุงู<br>
                        ๐ ุงุณู ุงููุดุฑูุน: ${testProjectData.name}<br>
                        ๐ฐ ุงูููุฒุงููุฉ: ${testProjectData.budget}<br>
                        ๐ ุงูุชูุงุฑูุฎ: ${testProjectData.start_date} ุฅูู ${testProjectData.end_date}<br>
                        ๐ ุงููููุน: ${testProjectData.city}, ${testProjectData.region}<br>
                        <strong>๐ก ูุงุฎุชุจุงุฑ ุงูุฅูุดุงุก ุงููุนููุ ุงุณุชุฎุฏู ูููุฐุฌ ุงููุดุฑูุน</strong>
                    </div>
                `;
                log("โ ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููุดุฑูุน ููุชูู");
            } catch (error) {
                result.innerHTML = `
                    <div class="status error">
                        โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููุดุฑูุน: ${error.message}
                    </div>
                `;
                log("โ ุฎุทุฃ ูู ุฅูุดุงุก ุงููุดุฑูุน: " + error.message);
            }
        }

        function openProjectForm() {
            window.open('/user/projects/new', '_blank');
            log("๐ ูุชุญ ูููุฐุฌ ุงููุดุฑูุน ูู ุชุจููุจ ุฌุฏูุฏ");
        }

        function fillFormWithTestData() {
            // This would fill the form if we're on the same page
            const formInstructions = `
                <div class="status warning">
                    ๐ ุชุนูููุงุช ููุก ุงููููุฐุฌ:<br>
                    1. ุงูุชุญ ูููุฐุฌ ุงููุดุฑูุน<br>
                    2. ุงููุฃ ุงูุญููู ุงูุชุงููุฉ:<br>
                    โข ุงุณู ุงููุดุฑูุน: ${testProjectData.name}<br>
                    โข ุงููุตู: ${testProjectData.description}<br>
                    โข ููุน ุงููุดุฑูุน: ${testProjectData.project_type}<br>
                    โข ุงูููุฒุงููุฉ: ${testProjectData.budget}<br>
                    โข ุชุงุฑูุฎ ุงูุจุฏุงูุฉ: ${testProjectData.start_date}<br>
                    โข ุชุงุฑูุฎ ุงูุงูุชูุงุก: ${testProjectData.end_date}<br>
                    โข ุงููุฏููุฉ: ${testProjectData.city}<br>
                    โข ุงูููุทูุฉ: ${testProjectData.region}<br>
                    โข ุงูุญู: ${testProjectData.district}<br>
                    3. ุงุถุบุท "ุญูุธ ุงููุดุฑูุน"<br>
                </div>
            `;
            
            document.getElementById('createResult').innerHTML = formInstructions;
            log("๐ ุชุนูููุงุช ููุก ุงููููุฐุฌ ูุนุฑูุถุฉ");
        }

        async function runAllTests() {
            log("๐ ุจุฏุก ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช...");
            showTestData();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testConnection();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testDatabaseSchema();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testProjectCreation();
            log("๐ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ููุชููุฉ!");
        }

        // Initialize
        log("๐งช ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููุดุฑูุน ุฌุงูุฒ");
    </script>
</body>
</html>
