(()=>{var e={};e.id=6728,e.ids=[6728],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10759:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>p,serverHooks:()=>h,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{POST:()=>y});var a=r(96559),n=r(48088),i=r(37719),o=r(32190),u=r(61223),c=r(44999),m=r(53292);async function y(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{invoiceId:a}=await e.json();if(!a)return o.NextResponse.json({error:"Invoice ID is required"},{status:400});let{data:n,error:i}=await t.from("invoices").select(`
        *,
        invoice_items (
          description,
          quantity,
          unit_price
        )
      `).eq("id",a).single();if(i||!n)return o.NextResponse.json({error:"Invoice not found"},{status:404});if(n.store_id!==r.id&&n.user_id!==r.id)return o.NextResponse.json({error:"Unauthorized access to invoice"},{status:403});let y=await m.K.createInvoicePaymentUrl({id:n.id,total_amount:n.total_amount,buyer_name:n.buyer_name,buyer_email:n.buyer_email,buyer_phone:n.buyer_phone,invoice_number:n.invoice_number,items:n.invoice_items||[]});if(y.success)return await t.from("invoices").update({payment_url:y.paymentUrl,payment_status:"pending",updated_at:new Date().toISOString()}).eq("id",a),o.NextResponse.json({success:!0,paymentUrl:y.paymentUrl});return o.NextResponse.json({success:!1,message:y.message},{status:400})}catch(e){return o.NextResponse.json({error:"Failed to create payment"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/fatoorah/create-payment/route",pathname:"/api/fatoorah/create-payment",filename:"route",bundlePath:"app/api/fatoorah/create-payment/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\fatoorah\\create-payment\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:d,serverHooks:h}=p;function v(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:d})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},53292:(e,t,r)=>{"use strict";r.d(t,{K:()=>a});class s{constructor(){this.config={apiKey:process.env.FATOORAH_API_KEY||"",baseUrl:process.env.FATOORAH_BASE_URL||"https://apitest.myfatoorah.com",isTestMode:!1}}async makeRequest(e,t="GET",r){let s=`${this.config.baseUrl}${e}`,a={"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`};try{let e=await fetch(s,{method:t,headers:a,...r&&{body:JSON.stringify(r)}});if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw e}}async createPayment(e){try{return await this.makeRequest("/v2/SendPayment","POST",e)}catch(e){return{isSuccess:!1,message:"Failed to create payment",validationErrors:[{error:e instanceof Error?e.message:"Unknown error"}]}}}async getPaymentMethods(e,t="KWD"){try{let r=await this.makeRequest("/v2/InitiatePayment","POST",{InvoiceAmount:e,CurrencyIso:t});if(r.IsSuccess)return r.Data.PaymentMethods||[];return[]}catch(e){return[]}}async executePayment(e){try{return await this.makeRequest("/v2/ExecutePayment","POST",{InvoiceValue:e.invoiceValue,PaymentMethodId:e.paymentMethodId,CustomerName:e.customerName,CustomerEmail:e.customerEmail,CustomerMobile:e.customerMobile,DisplayCurrencyIso:e.displayCurrencyIso||"KWD",CallBackUrl:e.callBackUrl,ErrorUrl:e.errorUrl,Language:e.language||"en"})}catch(e){return{isSuccess:!1,message:"Failed to execute payment"}}}async getPaymentStatus(e){try{let t=await this.makeRequest(`/v2/getPaymentStatus?Key=${e}&KeyType=PaymentId`);if(t.IsSuccess)return t.Data;return null}catch(e){return null}}async handleCallback(e){try{if(!e.paymentId)throw Error("Invalid callback data: missing paymentId");let t=await this.getPaymentStatus(e.paymentId);if(!t)throw Error("Unable to verify payment status");return{paymentId:e.paymentId,invoiceId:t.invoiceId.toString(),invoiceStatus:t.invoiceStatus,invoiceReference:t.invoiceReference,customerReference:t.customerReference,invoiceValue:t.invoiceValue,paidAmount:t.paidAmount,dueAmount:t.dueAmount,currencyIso:t.currencyIso,focusTransaction:t.invoiceTransactions[0]||{}}}catch(e){return null}}async cancelPayment(e){try{return(await this.makeRequest("/v2/CancelToken","POST",{Key:e,KeyType:"PaymentId"})).IsSuccess||!1}catch(e){return!1}}async refundPayment(e){try{return(await this.makeRequest("/v2/MakeRefund","POST",{Key:e.paymentId,KeyType:"PaymentId",RefundChargeOnCustomer:!1,ServiceChargeOnCustomer:!1,Amount:e.refundAmount,Comment:e.refundReason})).IsSuccess||!1}catch(e){return!1}}async getInvoiceLink(e){try{let t=await this.makeRequest(`/v2/GetDirectPaymentGateway/${e}`);if(t.IsSuccess&&t.Data)return t.Data.PaymentURL;return null}catch(e){return null}}validateWebhookSignature(e,t){try{return"mock_signature"===t}catch(e){return!1}}async getSupportedCurrencies(){try{return["KWD","SAR","AED","QAR","BHD","OMR","JOD","EGP","USD","EUR"]}catch(e){return["KWD"]}}formatAmount(e,t="KWD"){let r={KWD:{decimals:3,symbol:"د.ك"},SAR:{decimals:2,symbol:"﷼"},AED:{decimals:2,symbol:"د.إ"},QAR:{decimals:2,symbol:"﷼"},USD:{decimals:2,symbol:"$"},EUR:{decimals:2,symbol:"€"}},s=r[t]||r.KWD,a=e.toFixed(s.decimals);return`${a} ${s.symbol}`}}let a=new s},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,9398,1223,4999],()=>r(10759));module.exports=s})();