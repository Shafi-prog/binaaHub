(()=>{var e={};e.id=9086,e.ids=[9086],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},61338:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>_,serverHooks:()=>g,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{DELETE:()=>x,GET:()=>d,POST:()=>l,PUT:()=>p});var o=r(96559),n=r(48088),i=r(37719),a=r(32190),u=r(61223),c=r(44999);async function d(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:o}=new URL(e.url),n=o.get("language")||"ar",i=o.get("category_id"),d=o.get("search"),l=o.get("barcode"),p="true"===o.get("include_inactive"),x=parseInt(o.get("page")||"1"),_=parseInt(o.get("limit")||"20"),f=(x-1)*_,m=t.from("construction_products").select(`
        *,
        construction_categories!inner(
          id,
          name_ar,
          name_en
        )
      `).order("created_at",{ascending:!1}).range(f,f+_-1);if(p||(m=m.eq("is_active",!0)),i&&(m=m.eq("category_id",i)),l&&(m=m.or(`barcode.eq.${l},alternative_barcodes.cs.{${l}}`)),d){let e=`%${d}%`;m="ar"===n?m.or(`name_ar.ilike.${e},description_ar.ilike.${e},sku.ilike.${e}`):m.or(`name_en.ilike.${e},description_en.ilike.${e},sku.ilike.${e}`)}let{data:g,error:k}=await m;if(k)return a.NextResponse.json({error:"Failed to fetch products"},{status:500});let q=t.from("construction_products").select("*",{count:"exact",head:!0});if(p||(q=q.eq("is_active",!0)),i&&(q=q.eq("category_id",i)),l&&(q=q.or(`barcode.eq.${l},alternative_barcodes.cs.{${l}}`)),d){let e=`%${d}%`;q="ar"===n?q.or(`name_ar.ilike.${e},description_ar.ilike.${e},sku.ilike.${e}`):q.or(`name_en.ilike.${e},description_en.ilike.${e},sku.ilike.${e}`)}let{count:R}=await q;return a.NextResponse.json({success:!0,products:g,pagination:{page:x,limit:_,total:R||0,totalPages:Math.ceil((R||0)/_)}})}catch(e){return a.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{name_ar:o,name_en:n,description_ar:i,description_en:d,sku:l,barcode:p,alternative_barcodes:x,category_id:_,brand_ar:f,brand_en:m,model:g,saudi_standard:k,gsi_classification:q,specifications:R,unit_of_measure:j,minimum_stock:h,maximum_stock:w,reorder_level:N,current_stock:v,cost_price:y,selling_price:b,wholesale_price:U,currency:$="SAR",vat_rate:S=15,images:P,technical_sheet_url:I,safety_datasheet_url:C,is_hazardous:D=!1,requires_certification:O=!1}=await e.json();if(!o||0===o.trim().length)return a.NextResponse.json({error:"Arabic name is required"},{status:400});if(!l||0===l.trim().length)return a.NextResponse.json({error:"SKU is required"},{status:400});if(!_)return a.NextResponse.json({error:"Category is required"},{status:400});if(!j)return a.NextResponse.json({error:"Unit of measure is required"},{status:400});if(void 0===b||b<0)return a.NextResponse.json({error:"Valid selling price is required"},{status:400});let{data:E}=await t.from("construction_products").select("id").eq("sku",l.trim()).single();if(E)return a.NextResponse.json({error:"SKU already exists"},{status:409});if(p){let{data:e}=await t.from("construction_products").select("id").eq("barcode",p).single();if(e)return a.NextResponse.json({error:"Barcode already exists"},{status:409})}let F={id:`prod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name_ar:o.trim(),name_en:n?.trim()||null,description_ar:i?.trim()||null,description_en:d?.trim()||null,sku:l.trim().toUpperCase(),barcode:p||null,alternative_barcodes:x||[],category_id:_,brand_ar:f?.trim()||null,brand_en:m?.trim()||null,model:g?.trim()||null,saudi_standard:k?.trim()||null,gsi_classification:q?.trim()||null,specifications:R||{},unit_of_measure:j.trim(),minimum_stock:h||0,maximum_stock:w||null,reorder_level:N||null,current_stock:v||0,cost_price:y||null,selling_price:b,wholesale_price:U||null,currency:$,vat_rate:S,images:P||[],technical_sheet_url:I||null,safety_datasheet_url:C||null,is_active:!0,is_hazardous:D,requires_certification:O,created_by:r.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:A,error:T}=await t.from("construction_products").insert([F]).select().single();if(T)return a.NextResponse.json({error:"Failed to create product"},{status:500});return a.NextResponse.json({success:!0,product:A,message:"Product created successfully"},{status:201})}catch(e){return a.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{id:o,...n}=await e.json();if(!o)return a.NextResponse.json({error:"Product ID is required"},{status:400});let{data:i}=await t.from("construction_products").select("*").eq("id",o).single();if(!i)return a.NextResponse.json({error:"Product not found"},{status:404});if(n.sku&&n.sku!==i.sku){let{data:e}=await t.from("construction_products").select("id").eq("sku",n.sku.trim()).neq("id",o).single();if(e)return a.NextResponse.json({error:"SKU already exists"},{status:409})}if(n.barcode&&n.barcode!==i.barcode){let{data:e}=await t.from("construction_products").select("id").eq("barcode",n.barcode).neq("id",o).single();if(e)return a.NextResponse.json({error:"Barcode already exists"},{status:409})}let d={...n,updated_at:new Date().toISOString()},{data:l,error:p}=await t.from("construction_products").update(d).eq("id",o).select().single();if(p)return a.NextResponse.json({error:"Failed to update product"},{status:500});return a.NextResponse.json({success:!0,product:l,message:"Product updated successfully"})}catch(e){return a.NextResponse.json({error:"Internal server error"},{status:500})}}async function x(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:o}=new URL(e.url),n=o.get("id");if(!n)return a.NextResponse.json({error:"Product ID is required"},{status:400});let{data:i}=await t.from("construction_products").select("*").eq("id",n).single();if(!i)return a.NextResponse.json({error:"Product not found"},{status:404});let{error:d}=await t.from("construction_products").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",n);if(d)return a.NextResponse.json({error:"Failed to delete product"},{status:500});return a.NextResponse.json({success:!0,message:"Product deleted successfully"})}catch(e){return a.NextResponse.json({error:"Internal server error"},{status:500})}}let _=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/products/construction/route",pathname:"/api/products/construction",filename:"route",bundlePath:"app/api/products/construction/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\products\\construction\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:m,serverHooks:g}=_;function k(){return(0,i.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:m})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,9398,1223,4999],()=>r(61338));module.exports=s})();