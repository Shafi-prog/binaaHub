(()=>{var e={};e.id=4494,e.ids=[4494],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63769:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>x,serverHooks:()=>m,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>l,POST:()=>d,PUT:()=>p});var o=r(96559),n=r(48088),a=r(37719),i=r(32190),u=r(61223),c=r(44999);async function l(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:o}=new URL(e.url);o.get("language");let n="true"===o.get("include_inactive"),a=o.get("parent_id"),l=t.from("construction_categories").select("*").order("sort_order",{ascending:!0});n||(l=l.eq("is_active",!0)),a?l=l.eq("parent_id",a):null===a&&(l=l.is("parent_id",null));let{data:d,error:p}=await l;if(p)return i.NextResponse.json({error:"Failed to fetch categories"},{status:500});let g=new Map,x=[];return d?.forEach(e=>{g.set(e.id,{...e,children:[]})}),d?.forEach(e=>{let t=g.get(e.id);if(e.parent_id){let r=g.get(e.parent_id);r&&r.children.push(t)}else x.push(t)}),i.NextResponse.json({success:!0,categories:x,total:d?.length||0})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{name_ar:o,name_en:n,description_ar:a,description_en:l,parent_id:d,icon:p,sort_order:g=0}=await e.json();if(!o||0===o.trim().length)return i.NextResponse.json({error:"Arabic name is required"},{status:400});let x=1;if(d){let{data:e}=await t.from("construction_categories").select("level").eq("id",d).single();e&&(x=e.level+1)}let f={id:`cat_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name_ar:o.trim(),name_en:n?.trim()||null,description_ar:a?.trim()||null,description_en:l?.trim()||null,parent_id:d||null,icon:p||null,sort_order:g,level:x,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:_,error:m}=await t.from("construction_categories").insert([f]).select().single();if(m)return i.NextResponse.json({error:"Failed to create category"},{status:500});return i.NextResponse.json({success:!0,category:_,message:"Category created successfully"},{status:201})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{id:o,name_ar:n,name_en:a,description_ar:l,description_en:d,parent_id:p,icon:g,sort_order:x,is_active:f}=await e.json();if(!o)return i.NextResponse.json({error:"Category ID is required"},{status:400});if(!n||0===n.trim().length)return i.NextResponse.json({error:"Arabic name is required"},{status:400});let{data:_}=await t.from("construction_categories").select("*").eq("id",o).single();if(!_)return i.NextResponse.json({error:"Category not found"},{status:404});let m=_.level;if(p!==_.parent_id)if(p){let{data:e}=await t.from("construction_categories").select("level").eq("id",p).single();e&&(m=e.level+1)}else m=1;let h={name_ar:n.trim(),name_en:a?.trim()||null,description_ar:l?.trim()||null,description_en:d?.trim()||null,parent_id:p||null,icon:g||null,sort_order:x||_.sort_order,level:m,is_active:void 0!==f?f:_.is_active,updated_at:new Date().toISOString()},{data:R,error:j}=await t.from("construction_categories").update(h).eq("id",o).select().single();if(j)return i.NextResponse.json({error:"Failed to update category"},{status:500});return i.NextResponse.json({success:!0,category:R,message:"Category updated successfully"})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e){try{let t=(0,u.createRouteHandlerClient)({cookies:c.cookies}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:o}=new URL(e.url),n=o.get("id");if(!n)return i.NextResponse.json({error:"Category ID is required"},{status:400});let{data:a}=await t.from("construction_categories").select("*").eq("id",n).single();if(!a)return i.NextResponse.json({error:"Category not found"},{status:404});let{data:l}=await t.from("construction_categories").select("id").eq("parent_id",n);if(l&&l.length>0)return i.NextResponse.json({error:"Cannot delete category with subcategories"},{status:409});let{data:d}=await t.from("construction_products").select("id").eq("category_id",n);if(d&&d.length>0)return i.NextResponse.json({error:"Cannot delete category with products"},{status:409});let{error:p}=await t.from("construction_categories").delete().eq("id",n);if(p)return i.NextResponse.json({error:"Failed to delete category"},{status:500});return i.NextResponse.json({success:!0,message:"Category deleted successfully"})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/categories/construction/route",pathname:"/api/categories/construction",filename:"route",bundlePath:"app/api/categories/construction/route"},resolvedPagePath:"C:\\Users\\hp\\BinnaCodes\\binna\\src\\app\\api\\categories\\construction\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:_,serverHooks:m}=x;function h(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:_})}},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,9398,1223,4999],()=>r(63769));module.exports=s})();